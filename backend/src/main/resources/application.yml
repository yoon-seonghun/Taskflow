spring:
  profiles:
    active: local

  application:
    name: taskflow-backend

  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: Asia/Seoul
    property-naming-strategy: SNAKE_CASE
    serialization:
      write-dates-as-timestamps: false

  mvc:
    throw-exception-if-no-handler-found: true

  web:
    resources:
      add-mappings: false

server:
  port: 8080
  servlet:
    encoding:
      charset: UTF-8
      enabled: true
      force: true

# MyBatis Configuration
mybatis:
  mapper-locations: classpath:mapper/**/*.xml
  type-aliases-package: com.taskflow.domain
  configuration:
    map-underscore-to-camel-case: true
    jdbc-type-for-null: NULL

# Logging
logging:
  pattern:
    console: "[%d{yyyy-MM-dd HH:mm:ss}] [%level] [%thread] %logger{36} - %msg%n"
  level:
    root: INFO
    com.taskflow: DEBUG
    org.springframework.security: DEBUG

# File Upload Configuration
spring.servlet.multipart:
  enabled: true
  max-file-size: 10MB
  max-request-size: 50MB

---
# Local Profile
spring:
  config:
    activate:
      on-profile: local

  datasource:
    url: jdbc:mysql://localhost:3306/taskflow?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Seoul&characterEncoding=UTF-8
    username: taskflow
    password: taskflow123
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      idle-timeout: 30000
      connection-timeout: 20000

# JWT Configuration (Base64 encoded secret - 최소 256비트)
jwt:
  secret: ${JWT_SECRET:bG9jYWwtZGV2LWp3dC1zZWNyZXQta2V5LW11c3QtYmUtYXQtbGVhc3QtMjU2LWJpdHMtbG9uZy1mb3ItaHMyNTY=}
  access-token-validity: 1800000    # 30분 (밀리초)
  refresh-token-validity: 604800000  # 7일 (밀리초)

# CORS Configuration
cors:
  allowed-origins: http://localhost:3000,http://localhost:5173
  max-age: 3600

# Cookie Configuration (Local - HTTP)
cookie:
  secure: false

logging:
  level:
    com.taskflow.mapper: DEBUG

# File Storage Configuration (Local)
file:
  storage:
    type: LOCAL
    max-file-size: 10MB
    allowed-extensions:
      - jpg
      - jpeg
      - png
      - gif
      - webp
      - svg
      - pdf
      - doc
      - docx
      - xls
      - xlsx
      - ppt
      - pptx
      - txt
      - zip
    local:
      base-path: ./uploads

---
# Docker Profile
spring:
  config:
    activate:
      on-profile: docker

  datasource:
    url: jdbc:mysql://mysql:3306/taskflow?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Seoul&characterEncoding=UTF-8
    username: taskflow
    password: taskflow123
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 20
      minimum-idle: 10
      idle-timeout: 30000
      connection-timeout: 20000

jwt:
  secret: ${JWT_SECRET:ZG9ja2VyLWp3dC1zZWNyZXQta2V5LW11c3QtYmUtYXQtbGVhc3QtMjU2LWJpdHMtbG9uZy1mb3ItaHMyNTY=}
  access-token-validity: 1800000
  refresh-token-validity: 604800000

cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:3000}
  max-age: 3600

# Cookie Configuration (Docker - 내부 네트워크)
cookie:
  secure: ${COOKIE_SECURE:false}

logging:
  level:
    com.taskflow: INFO
    com.taskflow.mapper: INFO

# File Storage Configuration (Docker)
file:
  storage:
    type: LOCAL
    max-file-size: 10MB
    allowed-extensions:
      - jpg
      - jpeg
      - png
      - gif
      - webp
      - svg
      - pdf
      - doc
      - docx
      - xls
      - xlsx
      - ppt
      - pptx
      - txt
      - zip
    local:
      base-path: /app/uploads

---
# Production Profile
spring:
  config:
    activate:
      on-profile: prod

  datasource:
    url: ${DB_URL}
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 30
      minimum-idle: 10
      idle-timeout: 30000
      connection-timeout: 20000

jwt:
  secret: ${JWT_SECRET}
  access-token-validity: 1800000
  refresh-token-validity: 604800000

cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS}
  max-age: 3600

# Cookie Configuration (Production - HTTPS 필수)
cookie:
  secure: true

logging:
  level:
    root: WARN
    com.taskflow: INFO

# File Storage Configuration (Production - 환경변수로 유연하게 설정)
file:
  storage:
    type: ${FILE_STORAGE_TYPE:LOCAL}
    max-file-size: ${FILE_MAX_SIZE:10MB}
    allowed-extensions:
      - jpg
      - jpeg
      - png
      - gif
      - webp
      - svg
      - pdf
      - doc
      - docx
      - xls
      - xlsx
      - ppt
      - pptx
      - txt
      - zip
    local:
      base-path: ${FILE_LOCAL_PATH:/app/uploads}
    nas:
      base-path: ${FILE_NAS_PATH:}
      mount-path: ${FILE_NAS_MOUNT:}
    s3:
      bucket: ${AWS_S3_BUCKET:}
      region: ${AWS_REGION:}
      access-key: ${AWS_ACCESS_KEY:}
      secret-key: ${AWS_SECRET_KEY:}
