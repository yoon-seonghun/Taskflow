import{G as oe,r as m,c as y,Q as re,S as ae,O as se,P as ue}from"./index-D8qsMxsh.js";import{i as E}from"./item-CAonLf5Y.js";function le(n){if(!n.dueDate||n.status==="COMPLETED"||n.status==="DELETED")return!1;const d=new Date;d.setHours(0,0,0,0);const o=new Date(n.dueDate);return o.setHours(0,0,0,0),o<d}function ve(n){if(!n.dueDate||!le(n))return 0;const d=new Date;d.setHours(0,0,0,0);const o=new Date(n.dueDate);o.setHours(0,0,0,0);const g=d.getTime()-o.getTime();return Math.ceil(g/(1e3*60*60*24))}const ye=oe("item",()=>{const n=m([]),d=m(!1),o=m(null),g=m(null),I=m(null),h=m({includeCompleted:!1,includeDeleted:!1}),w=m(null),P=m(null),x=y(()=>n.value.find(t=>t.itemId===g.value)||null),_=y(()=>n.value.filter(t=>t.status!=="COMPLETED"&&t.status!=="DELETED")),R=y(()=>n.value.filter(t=>t.status==="COMPLETED")),B=y(()=>n.value.filter(t=>t.status==="DELETED")),T=y(()=>n.value.filter(t=>t.status==="PENDING")),N=y(()=>n.value.filter(t=>le(t))),G=y(()=>N.value.length),Y=y(()=>{const t=new Date().toISOString().split("T")[0];return n.value.filter(r=>r.status==="COMPLETED"&&r.completedAt?r.completedAt.startsWith(t):r.status==="DELETED"&&r.deletedAt?r.deletedAt.startsWith(t):!1)}),H=y(()=>{const t={};for(const r of _.value){const u=r.groupId||0;t[u]||(t[u]=[]),t[u].push(r)}return t}),U=y(()=>({NOT_STARTED:n.value.filter(t=>t.status==="NOT_STARTED"),IN_PROGRESS:n.value.filter(t=>t.status==="IN_PROGRESS"),PENDING:n.value.filter(t=>t.status==="PENDING"),COMPLETED:n.value.filter(t=>t.status==="COMPLETED"),DELETED:n.value.filter(t=>t.status==="DELETED")})),W=y(()=>n.value.length),A=y(()=>_.value.length);function F(t){n.value=t}function M(t){n.value.unshift(t)}function c(t,r){const u=n.value.findIndex(p=>p.itemId===t);u!==-1&&(n.value[u]={...n.value[u],...r})}function Q(t){n.value=n.value.filter(r=>r.itemId!==t)}async function V(t,r){d.value=!0,o.value=null,I.value=t;try{const u=await E.getItems(t,{...h.value,...r});return u.success&&u.data?(F(u.data.content),!0):(o.value=u.message||"아이템 목록을 불러오는데 실패했습니다.",!1)}catch{return o.value="아이템 목록을 불러오는데 실패했습니다.",!1}finally{d.value=!1}}async function j(t,r){try{const u=await E.getItem(t,r);return u.success&&u.data?(c(r,u.data),u.data):null}catch{return null}}async function k(t,r){d.value=!0,o.value=null;try{const u=await E.createItem(t,r);return u.success&&u.data?(M(u.data),u.data):(o.value=u.message||"아이템 생성에 실패했습니다.",null)}catch{return o.value="아이템 생성에 실패했습니다.",null}finally{d.value=!1}}async function q(t,r,u){const p=n.value.find(v=>v.itemId===r);if(!p)try{const v=await E.updateItem(t,r,u);return v.success&&v.data?v.data:(o.value=v.message||"아이템 수정에 실패했습니다.",null)}catch{return o.value="아이템 수정에 실패했습니다.",null}const f={...p};c(r,u);try{const v=await E.updateItem(t,r,u);return v.success&&v.data?(c(r,v.data),v.data):(c(r,f),o.value=v.message||"아이템 수정에 실패했습니다.",null)}catch{return c(r,f),o.value="아이템 수정에 실패했습니다.",null}}async function b(t,r){const u=[...n.value];c(r,{status:"DELETED",deletedAt:new Date().toISOString()});try{const p=await E.deleteItem(t,r);return p.success?!0:(n.value=u,o.value=p.message||"아이템 삭제에 실패했습니다.",!1)}catch{return n.value=u,o.value="아이템 삭제에 실패했습니다.",!1}}async function z(t,r){const u=n.value.find(f=>f.itemId===r);if(!u)return!1;const p={...u};c(r,{status:"COMPLETED",completedAt:new Date().toISOString()});try{const f=await E.completeItem(t,r);return f.success&&f.data?(c(r,f.data),!0):(c(r,p),o.value=f.message||"완료 처리에 실패했습니다.",!1)}catch{return c(r,p),o.value="완료 처리에 실패했습니다.",!1}}async function J(t,r){const u=n.value.find(f=>f.itemId===r);if(!u)return!1;const p={...u};c(r,{status:"NOT_STARTED",completedAt:void 0,deletedAt:void 0});try{const f=await E.restoreItem(t,r);return f.success&&f.data?(c(r,f.data),!0):(c(r,p),o.value=f.message||"복원에 실패했습니다.",!1)}catch{return c(r,p),o.value="복원에 실패했습니다.",!1}}async function K(t,r,u,p){const f=n.value.find(C=>C.itemId===r);if(!f)return!1;const v=f.propertyValues?{...f.propertyValues}:{},O={...v,[u]:p};c(r,{propertyValues:O});try{const C=await E.updateItem(t,r,{properties:{[u]:p}});return C.success&&C.data?(c(r,C.data),!0):(c(r,{propertyValues:v}),!1)}catch{return c(r,{propertyValues:v}),!1}}async function X(t,r,u,p){const f=n.value.find(O=>O.itemId===r);if(!f)return!1;const v={...f};c(r,{sortOrder:u,groupId:p??f.groupId});try{const O=await E.updateItem(t,r,{sortOrder:u,groupId:p});return O.success&&O.data?(c(r,O.data),!0):(c(r,v),!1)}catch{return c(r,v),!1}}function Z(t){g.value=t}function ee(t){I.value=t}function te(t){h.value={...h.value,...t}}function ne(t){return n.value.find(r=>r.itemId===t)}function e(){n.value=[],g.value=null,o.value=null}function a(){o.value=null}function s(t){t.boardId===I.value&&(n.value.find(r=>r.itemId===t.itemId)||M(t))}function l(t){c(t.itemId,t)}function i(t){Q(t)}function L(t,r){c(t,r)}function $(t,r){w.value=t;const u=n.value.find(p=>p.itemId===t);P.value=r||(u?{...u}:null)}function D(t){P.value&&(P.value={...P.value,...t})}function ie(){w.value=null,P.value=null}function ce(t){return w.value===t}function fe(){return P.value}return{items:n,loading:d,error:o,selectedItemId:g,currentBoardId:I,filters:h,editingItemId:w,editingItemData:P,selectedItem:x,activeItems:_,completedItems:R,deletedItems:B,pendingItems:T,overdueItems:N,overdueItemCount:G,todayCompletedItems:Y,itemsByGroup:H,itemsByStatus:U,itemCount:W,activeItemCount:A,fetchItems:V,fetchItem:j,createItem:k,updateItem:q,deleteItem:b,completeItem:z,restoreItem:J,updateItemProperty:K,reorderItem:X,selectItem:Z,setBoardId:ee,setFilters:te,getItemById:ne,clearItems:e,clearError:a,handleSseItemCreated:s,handleSseItemUpdated:l,handleSseItemDeleted:i,updateItemLocal:L,startEditing:$,updateEditingData:D,stopEditing:ie,isEditing:ce,getEditingData:fe}}),S={getProperties(n){return ue(`/boards/${n}/properties`)},createProperty(n,d){return se(`/boards/${n}/properties`,d)},updateProperty(n,d){return ae(`/properties/${n}`,d)},deleteProperty(n){return re(`/properties/${n}`)},getOptions(n){return ue(`/properties/${n}/options`)},createOption(n,d){return se(`/properties/${n}/options`,d)},updateOption(n,d){return ae(`/options/${n}`,d)},deleteOption(n){return re(`/options/${n}`)}},ge=oe("property",()=>{const n=m([]),d=m(!1),o=m(null),g=m(null),I=y(()=>n.value.filter(e=>e.useYn!=="N")),h=y(()=>I.value.filter(e=>e.visibleYn==="Y"||e.visibleYn===void 0&&e.hiddenYn!=="Y")),w=y(()=>[...h.value].sort((e,a)=>(e.sortOrder??0)-(a.sortOrder??0))),P=y(()=>n.value.filter(e=>e.systemYn==="Y")),x=y(()=>I.value.filter(e=>e.systemYn!=="Y")),_=y(()=>I.value.filter(e=>e.propertyType==="SELECT"||e.propertyType==="MULTI_SELECT"));function R(e){n.value=e}function B(e){n.value.push(e)}function T(e,a){const s=n.value.findIndex(l=>l.propertyId===e);s!==-1&&(n.value[s]={...n.value[s],...a})}function N(e){n.value=n.value.filter(a=>a.propertyId!==e)}function G(e,a){const s=n.value.find(l=>l.propertyId===e);s&&(s.options=[...s.options||[],a])}function Y(e,a,s){const l=n.value.find(i=>i.propertyId===e);if(l!=null&&l.options){const i=l.options.findIndex(L=>L.optionId===a);i!==-1&&(l.options[i]={...l.options[i],...s})}}function H(e,a){const s=n.value.find(l=>l.propertyId===e);s!=null&&s.options&&(s.options=s.options.filter(l=>l.optionId!==a))}async function U(e){d.value=!0,o.value=null,g.value=e;try{const a=await S.getProperties(e);return a.success&&a.data?(R(a.data),!0):(o.value=a.message||"속성 정의를 불러오는데 실패했습니다.",!1)}catch{return o.value="속성 정의를 불러오는데 실패했습니다.",!1}finally{d.value=!1}}async function W(e,a){d.value=!0,o.value=null;try{const s=await S.createProperty(e,a);return s.success&&s.data?(B(s.data),s.data):(o.value=s.message||"속성 생성에 실패했습니다.",null)}catch{return o.value="속성 생성에 실패했습니다.",null}finally{d.value=!1}}async function A(e,a){const s=n.value.find(i=>i.propertyId===e);if(!s)return!1;const l={...s};T(e,a);try{const i=await S.updateProperty(e,a);return i.success&&i.data?(T(e,i.data),!0):(T(e,l),o.value=i.message||"속성 수정에 실패했습니다.",!1)}catch{return T(e,l),o.value="속성 수정에 실패했습니다.",!1}}async function F(e){const a=[...n.value];N(e);try{const s=await S.deleteProperty(e);return s.success?!0:(n.value=a,o.value=s.message||"속성 삭제에 실패했습니다.",!1)}catch{return n.value=a,o.value="속성 삭제에 실패했습니다.",!1}}async function M(e){const a=n.value.find(i=>i.propertyId===e);if(!a)return!1;const l=a.visibleYn==="Y"||a.visibleYn===void 0&&a.hiddenYn!=="Y"?"N":"Y";return A(e,{visibleYn:l})}async function c(e,a){return A(e,{sortOrder:a})}async function Q(e,a){try{const s=await S.createOption(e,a);return s.success&&s.data?(G(e,s.data),s.data):(o.value=s.message||"옵션 생성에 실패했습니다.",null)}catch{return o.value="옵션 생성에 실패했습니다.",null}}async function V(e,a,s){var $;const l=n.value.find(D=>D.propertyId===e),i=($=l==null?void 0:l.options)==null?void 0:$.find(D=>D.optionId===a);if(!i)return!1;const L={...i};Y(e,a,s);try{const D=await S.updateOption(a,s);return D.success&&D.data?(Y(e,a,D.data),!0):(Y(e,a,L),o.value=D.message||"옵션 수정에 실패했습니다.",!1)}catch{return Y(e,a,L),o.value="옵션 수정에 실패했습니다.",!1}}async function j(e,a){const s=n.value.find(i=>i.propertyId===e),l=s!=null&&s.options?[...s.options]:[];H(e,a);try{const i=await S.deleteOption(a);return i.success?!0:(s&&(s.options=l),o.value=i.message||"옵션 삭제에 실패했습니다.",!1)}catch{return s&&(s.options=l),o.value="옵션 삭제에 실패했습니다.",!1}}async function k(e,a,s){return V(e,a,{sortOrder:s})}function q(e){g.value=e}function b(e){return n.value.find(a=>a.propertyId===e)}function z(e){return n.value.find(a=>a.propertyCode===e||a.propertyName===e)}function J(e){var s;const a=b(e);return((s=a==null?void 0:a.options)==null?void 0:s.filter(l=>l.useYn==="Y"))||[]}function K(e,a){var l;const s=b(e);return(l=s==null?void 0:s.options)==null?void 0:l.find(i=>i.optionId===a)}function X(){n.value=[],g.value=null,o.value=null}function Z(){o.value=null}function ee(e){e.boardId===g.value&&(n.value.find(a=>a.propertyId===e.propertyId)||B(e))}function te(e){T(e.propertyId,e)}function ne(e){N(e)}return{propertyDefinitions:n,loading:d,error:o,currentBoardId:g,activeProperties:I,visibleProperties:h,sortedProperties:w,systemProperties:P,customProperties:x,selectProperties:_,fetchProperties:U,createProperty:W,updateProperty:A,deleteProperty:F,togglePropertyVisibility:M,reorderProperty:c,createOption:Q,updateOption:V,deleteOption:j,reorderOption:k,setBoardId:q,getPropertyById:b,getPropertyByCode:z,getOptionsByPropertyId:J,getOptionById:K,clearProperties:X,clearError:Z,handleSsePropertyCreated:ee,handleSsePropertyUpdated:te,handleSsePropertyDeleted:ne}});export{ge as a,ve as g,le as i,ye as u};
