import{d as W,f as m,g as e,q as U,p,n,c as se,t as u,F as z,s as X,k as f,m as Z,D as me,r as c,z as ce,o as pe,i as I,x as S,l as ee,L as te}from"./index-D8qsMxsh.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as ae}from"./Badge.vue_vue_type_script_setup_true_lang-BICiYF9q.js";import{_ as L}from"./Pagination.vue_vue_type_script_setup_true_lang-D8QDOFFt.js";import{_ as F}from"./Input.vue_vue_type_script_setup_true_lang-DbFXPxNG.js";import{_ as K}from"./Select.vue_vue_type_script_setup_true_lang-CpAO5_7Q.js";import{h as le}from"./history-B3yM7zqs.js";import{u as ye}from"./useSlideOver-DM1nQhnY.js";const ge={class:"history-switch"},he=W({__name:"HistorySwitch",props:{modelValue:{}},emits:["update:modelValue"],setup(g,{emit:b}){const D=b;function x(l){D("update:modelValue",l)}return(l,d)=>(n(),m("div",ge,[e("button",{type:"button",class:U(["switch-btn",{active:g.modelValue==="all"}]),onClick:d[0]||(d[0]=h=>x("all"))},[...d[3]||(d[3]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})],-1),p(" 전체 이력 ",-1)])],2),e("button",{type:"button",class:U(["switch-btn",{active:g.modelValue==="item"}]),onClick:d[1]||(d[1]=h=>x("item"))},[...d[4]||(d[4]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})],-1),p(" 작업 처리 이력 ",-1)])],2),e("button",{type:"button",class:U(["switch-btn",{active:g.modelValue==="template"}]),onClick:d[2]||(d[2]=h=>x("template"))},[...d[5]||(d[5]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),p(" 작업 등록 이력 ",-1)])],2)]))}}),fe=q(he,[["__scopeId","data-v-7bd8b19f"]]),xe={class:"history-table-wrapper"},we={key:0,class:"py-12 text-center"},ke={key:1,class:"py-12 text-center"},be={class:"mt-2 text-sm text-gray-500"},De={key:2,class:"history-table"},Ve={class:"font-medium text-gray-900"},Ce={class:"flex items-center gap-2"},_e=["title"],Ee=["onClick"],Te={key:3,class:"history-table"},Ie={class:"font-medium text-gray-900"},He=["title"],$e=W({__name:"HistoryTable",props:{type:{},itemHistories:{default:()=>[]},templateHistories:{default:()=>[]},loading:{type:Boolean,default:!1}},emits:["openItem"],setup(g,{emit:b}){const D=g,x=b;function l(y){if(!y)return"-";const v=new Date(y);return isNaN(v.getTime())?"-":v.toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}function d(y){switch(y){case"COMPLETED":return{label:"완료",variant:"success"};case"DELETED":return{label:"삭제",variant:"danger"};default:return{label:y,variant:"default"}}}function h(y){switch(y){case"ACTIVE":return{label:"활성",variant:"success"};case"INACTIVE":return{label:"비활성",variant:"default"};default:return{label:y,variant:"default"}}}const E=se(()=>D.type==="item"?D.itemHistories.length===0:D.templateHistories.length===0);return(y,v)=>(n(),m("div",xe,[g.loading?(n(),m("div",we,[...v[0]||(v[0]=[e("svg",{class:"animate-spin h-8 w-8 mx-auto text-gray-400",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})],-1),e("p",{class:"mt-2 text-sm text-gray-500"},"이력을 불러오는 중...",-1)])])):E.value?(n(),m("div",ke,[v[1]||(v[1]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",be,u(g.type==="item"?"작업 처리 이력이 없습니다.":"작업 등록 이력이 없습니다."),1)])):g.type==="item"?(n(),m("table",De,[v[2]||(v[2]=e("thead",null,[e("tr",null,[e("th",{class:"w-[300px]"},"작업내용"),e("th",{class:"w-[80px]"},"작업결과"),e("th",{class:"w-[100px]"},"작업자"),e("th",{class:"w-[140px]"},"등록시간"),e("th",{class:"w-[140px]"},"시작시간"),e("th",{class:"w-[140px]"},"완료시간"),e("th",{class:"w-[140px]"},"수정시간"),e("th",{class:"w-[140px]"},"삭제시간")])],-1)),e("tbody",null,[(n(!0),m(z,null,X(g.itemHistories,s=>(n(),m("tr",{key:s.itemId,class:"group"},[e("td",Ve,[e("div",Ce,[e("span",{class:"truncate flex-1",title:s.title},u(s.title),9,_e),e("button",{class:"flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity px-1.5 py-0.5 text-[11px] text-gray-500 hover:text-primary-600 hover:bg-primary-50 rounded",title:"상세 패널 열기",onClick:P=>x("openItem",s.itemId,s.boardId)}," 열기 ",8,Ee)])]),e("td",null,[f(ae,{variant:d(s.result).variant,size:"sm"},{default:Z(()=>[p(u(d(s.result).label),1)]),_:2},1032,["variant"])]),e("td",null,u(s.workerName||"-"),1),e("td",null,u(l(s.createdAt)),1),e("td",null,u(l(s.startTime)),1),e("td",null,u(l(s.completedAt)),1),e("td",null,u(l(s.updatedAt)),1),e("td",null,u(l(s.deletedAt)),1)]))),128))])])):(n(),m("table",Te,[v[3]||(v[3]=e("thead",null,[e("tr",null,[e("th",{class:"w-[400px]"},"작업내용"),e("th",{class:"w-[100px]"},"등록자"),e("th",{class:"w-[160px]"},"등록시간"),e("th",{class:"w-[160px]"},"수정시간"),e("th",{class:"w-[80px]"},"상태")])],-1)),e("tbody",null,[(n(!0),m(z,null,X(g.templateHistories,s=>(n(),m("tr",{key:s.templateId},[e("td",Ie,[e("div",{class:"truncate max-w-[400px]",title:s.content},u(s.content),9,He)]),e("td",null,u(s.createdByName||"-"),1),e("td",null,u(l(s.createdAt)),1),e("td",null,u(l(s.updatedAt)),1),e("td",null,[f(ae,{variant:h(s.status).variant,size:"sm"},{default:Z(()=>[p(u(h(s.status).label),1)]),_:2},1032,["variant"])])]))),128))])]))]))}}),R=q($e,[["__scopeId","data-v-7bdb1d3c"]]),Me={class:"history-view"},Be={class:"mb-6"},Se={class:"filter-section"},Pe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Ae={key:0,class:"mt-4 flex items-center gap-4"},je={class:"flex items-center gap-2"},Oe={class:"flex items-center gap-2"},ze={class:"flex items-center justify-between mb-4"},Ne={class:"text-sm text-gray-600"},Ue={class:"font-medium text-gray-900"},Le={class:"font-medium text-blue-600"},Fe={class:"font-medium text-green-600"},Ke={class:"mb-8"},Re={class:"section-header"},We={class:"section-title"},qe={class:"text-sm font-normal text-gray-500"},Ye={class:"table-container"},Ge={key:0,class:"mt-4 flex justify-center"},Je={class:"section-header"},Qe={class:"section-title"},Xe={class:"text-sm font-normal text-gray-500"},Ze={class:"table-container"},et={key:0,class:"mt-4 flex justify-center"},tt={class:"flex items-center justify-between mb-4"},at={class:"text-sm text-gray-600"},lt={class:"font-medium text-gray-900"},st={class:"table-container"},ot={key:0,class:"mt-6 flex justify-center"},nt=W({__name:"HistoryView",setup(g){const b=me(),{openItemDetail:D}=ye();function x(o,t){D(o,t)}const l=c("all"),d=c(!1),h=c(!1),E=c(!1),y=c([]),v=c(0),s=c(0),P=c([]),H=c(0),$=c(0),M=c(""),r=c({page:0,size:20,keyword:"",result:void 0,startDate:"",endDate:""}),i=c({page:0,size:20,keyword:"",status:void 0,startDate:"",endDate:""}),oe=[{value:"",label:"전체"},{value:"COMPLETED",label:"완료",color:"#10B981"},{value:"DELETED",label:"삭제",color:"#EF4444"}],ne=[{value:"",label:"전체"},{value:"ACTIVE",label:"활성",color:"#10B981"},{value:"INACTIVE",label:"비활성",color:"#6B7280"}],re=[{value:"",label:"전체 기간"},{value:"today",label:"오늘"},{value:"week",label:"이번 주"},{value:"month",label:"이번 달"},{value:"custom",label:"직접 입력"}],B=c(""),w=c(""),k=c(""),ie=se(()=>s.value+$.value);function ue(o){const t=(o==null?void 0:o.toString())??"";B.value=t;const a=new Date;let C="",_="";switch(t){case"today":C=T(a),_=T(a);break;case"week":{const O=new Date(a),Q=a.getDay(),ve=Q===0?6:Q-1;O.setDate(a.getDate()-ve),C=T(O),_=T(a);break}case"month":{const O=new Date(a.getFullYear(),a.getMonth(),1);C=T(O),_=T(a);break}case"custom":return;default:C="",_=""}w.value=C,k.value=_,r.value.startDate=C,r.value.endDate=_,i.value.startDate=C,i.value.endDate=_}function T(o){return o.toISOString().split("T")[0]}function Y(){if(w.value&&k.value&&w.value>k.value){b.showWarning("시작일은 종료일보다 이전이어야 합니다.");return}r.value.startDate=w.value,r.value.endDate=k.value,i.value.startDate=w.value,i.value.endDate=k.value}async function A(){h.value=!0;try{const o=l.value==="all"?M.value:r.value.keyword,t={...r.value,keyword:o||void 0,result:r.value.result||void 0,startDate:r.value.startDate||void 0,endDate:r.value.endDate||void 0},a=await le.getItemHistory(t);y.value=a.data.content,v.value=a.data.totalPages,s.value=a.data.totalElements}catch(o){console.error("Failed to load item history:",o),b.showError("작업 처리 이력을 불러오는데 실패했습니다.")}finally{h.value=!1}}async function j(){E.value=!0;try{const o=l.value==="all"?M.value:i.value.keyword,t={...i.value,keyword:o||void 0,status:i.value.status||void 0,startDate:i.value.startDate||void 0,endDate:i.value.endDate||void 0},a=await le.getTemplateHistory(t);P.value=a.data.content,H.value=a.data.totalPages,$.value=a.data.totalElements}catch(o){console.error("Failed to load template history:",o),b.showError("작업 등록 이력을 불러오는데 실패했습니다.")}finally{E.value=!1}}async function N(){d.value=!0;try{await Promise.all([A(),j()])}finally{d.value=!1}}function V(){l.value==="all"?(r.value.page=0,i.value.page=0,N()):l.value==="item"?(r.value.page=0,A()):(i.value.page=0,j())}function G(o){r.value.page=o,A()}function J(o){i.value.page=o,j()}function de(o){l.value==="item"?G(o):l.value==="template"&&J(o)}return ce(l,o=>{B.value="",w.value="",k.value="",r.value.page=0,r.value.startDate="",r.value.endDate="",i.value.page=0,i.value.startDate="",i.value.endDate="",M.value="",o==="all"?N():o==="item"?A():j()}),pe(()=>{N()}),(o,t)=>(n(),m("div",Me,[t[25]||(t[25]=e("div",{class:"mb-6"},[e("h1",{class:"text-xl font-semibold text-gray-900"},"이력관리"),e("p",{class:"mt-1 text-sm text-gray-500"}," 작업 처리 이력과 작업 등록 이력을 조회합니다. ")],-1)),e("div",Be,[f(fe,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=a=>l.value=a)},null,8,["modelValue"])]),e("div",Se,[e("div",Pe,[l.value==="all"?(n(),S(F,{key:0,modelValue:M.value,"onUpdate:modelValue":t[1]||(t[1]=a=>M.value=a),placeholder:"작업 내용 검색...",clearable:!0,onEnter:V},null,8,["modelValue"])):l.value==="item"?(n(),S(F,{key:1,modelValue:r.value.keyword,"onUpdate:modelValue":t[2]||(t[2]=a=>r.value.keyword=a),placeholder:"작업 내용 검색...",clearable:!0,onEnter:V},null,8,["modelValue"])):(n(),S(F,{key:2,modelValue:i.value.keyword,"onUpdate:modelValue":t[3]||(t[3]=a=>i.value.keyword=a),placeholder:"작업 내용 검색...",clearable:!0,onEnter:V},null,8,["modelValue"])),l.value==="all"||l.value==="item"?(n(),S(K,{key:3,modelValue:r.value.result,"onUpdate:modelValue":t[4]||(t[4]=a=>r.value.result=a),options:oe,placeholder:"작업 결과",clearable:!0,onChange:V},null,8,["modelValue"])):I("",!0),l.value==="all"||l.value==="template"?(n(),S(K,{key:4,modelValue:i.value.status,"onUpdate:modelValue":t[5]||(t[5]=a=>i.value.status=a),options:ne,placeholder:"템플릿 상태",clearable:!0,onChange:V},null,8,["modelValue"])):I("",!0),f(K,{modelValue:B.value,"onUpdate:modelValue":t[6]||(t[6]=a=>B.value=a),options:re,placeholder:"기간 선택",onChange:ue},null,8,["modelValue"]),e("button",{type:"button",class:"btn-primary h-8",onClick:V},[...t[9]||(t[9]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1),p(" 검색 ",-1)])])]),B.value==="custom"?(n(),m("div",Ae,[e("div",je,[t[10]||(t[10]=e("span",{class:"text-sm text-gray-600"},"시작일",-1)),ee(e("input",{"onUpdate:modelValue":t[7]||(t[7]=a=>w.value=a),type:"date",class:"date-input",onChange:Y},null,544),[[te,w.value]])]),t[12]||(t[12]=e("span",{class:"text-gray-400"},"~",-1)),e("div",Oe,[t[11]||(t[11]=e("span",{class:"text-sm text-gray-600"},"종료일",-1)),ee(e("input",{"onUpdate:modelValue":t[8]||(t[8]=a=>k.value=a),type:"date",class:"date-input",onChange:Y},null,544),[[te,k.value]])]),e("button",{type:"button",class:"btn-secondary h-8",onClick:V}," 적용 ")])):I("",!0)]),l.value==="all"?(n(),m(z,{key:0},[e("div",ze,[e("p",Ne,[t[13]||(t[13]=p(" 전체 ",-1)),e("span",Ue,u(ie.value),1),t[14]||(t[14]=p(" 건 ",-1)),t[15]||(t[15]=e("span",{class:"text-gray-400 mx-2"},"|",-1)),t[16]||(t[16]=p(" 작업 처리 ",-1)),e("span",Le,u(s.value),1),t[17]||(t[17]=p(" 건, 작업 등록 ",-1)),e("span",Fe,u($.value),1),t[18]||(t[18]=p(" 건 ",-1))])]),e("div",Ke,[e("div",Re,[e("h2",We,[t[19]||(t[19]=e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})],-1)),t[20]||(t[20]=p(" 작업 처리 이력 ",-1)),e("span",qe,"("+u(s.value)+"건)",1)])]),e("div",Ye,[f(R,{type:"item","item-histories":y.value,loading:h.value,onOpenItem:x},null,8,["item-histories","loading"])]),v.value>1?(n(),m("div",Ge,[f(L,{"current-page":r.value.page??0,"total-pages":v.value,onChange:G},null,8,["current-page","total-pages"])])):I("",!0)]),e("div",null,[e("div",Je,[e("h2",Qe,[t[21]||(t[21]=e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),t[22]||(t[22]=p(" 작업 등록 이력 ",-1)),e("span",Xe,"("+u($.value)+"건)",1)])]),e("div",Ze,[f(R,{type:"template","template-histories":P.value,loading:E.value,onOpenItem:x},null,8,["template-histories","loading"])]),H.value>1?(n(),m("div",et,[f(L,{"current-page":i.value.page??0,"total-pages":H.value,onChange:J},null,8,["current-page","total-pages"])])):I("",!0)])],64)):(n(),m(z,{key:1},[e("div",tt,[e("p",at,[t[23]||(t[23]=p(" 총 ",-1)),e("span",lt,u(l.value==="item"?s.value:$.value),1),t[24]||(t[24]=p(" 건 ",-1))])]),e("div",st,[f(R,{type:l.value,"item-histories":y.value,"template-histories":P.value,loading:l.value==="item"?h.value:E.value,onOpenItem:x},null,8,["type","item-histories","template-histories","loading"])]),(l.value==="item"?v.value:H.value)>1?(n(),m("div",ot,[f(L,{"current-page":l.value==="item"?r.value.page??0:i.value.page??0,"total-pages":l.value==="item"?v.value:H.value,onChange:de},null,8,["current-page","total-pages"])])):I("",!0)],64))]))}}),yt=q(nt,[["__scopeId","data-v-86188b50"]]);export{yt as default};
