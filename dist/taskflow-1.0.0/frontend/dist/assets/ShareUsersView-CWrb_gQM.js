import{_ as j}from"./Input.vue_vue_type_script_setup_true_lang-DbFXPxNG.js";import{_ as U}from"./Select.vue_vue_type_script_setup_true_lang-CpAO5_7Q.js";import{u as A}from"./user-BWwGCR1b.js";import{d as V,D as N,r as g,c as M,f as a,g as e,k as $,i as B,F as z,s as R,t as v,p as S,n as o,m as F,z as L,o as T,h as D}from"./index-D8qsMxsh.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as H}from"./Badge.vue_vue_type_script_setup_true_lang-BICiYF9q.js";import{u as K}from"./board-BqBw7K7S.js";const O={class:"share-user-search"},P={key:0,class:"space-y-3"},W={class:"relative"},Y=["disabled"],q={key:0,class:"animate-spin w-4 h-4",fill:"none",viewBox:"0 0 24 24"},G={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},J={key:0,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},Q={key:0,class:"px-4 py-3 text-sm text-gray-500"},X=["onClick"],Z={class:"w-8 h-8 rounded-full bg-primary-100 flex items-center justify-center"},ee={class:"text-sm font-medium text-primary-700"},te={class:"text-sm font-medium text-gray-900"},se={class:"text-xs text-gray-500"},ae={key:0,class:"ml-auto text-xs text-gray-400"},oe={key:1,class:"space-y-3"},re={class:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg"},le={class:"w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center"},ne={class:"text-base font-medium text-primary-700"},ie={class:"flex-1"},de={class:"text-sm font-medium text-gray-900"},ce={class:"text-xs text-gray-500"},ue=["disabled"],me=V({__name:"ShareUserSearch",props:{existingUserIds:{default:()=>[]},loading:{type:Boolean,default:!1}},emits:["add"],setup(b,{emit:c}){const u=b,i=c,x=N(),p=g(""),h=g([]),y=g(!1),l=g(!1),t=g(null),d=g("MEMBER"),k=[{value:"MEMBER",label:"멤버 (조회/수정)"},{value:"VIEWER",label:"뷰어 (조회만)"}],C=M(()=>t.value&&!u.loading);async function E(){if(!p.value.trim()){h.value=[],l.value=!1;return}y.value=!0;try{const m=await A.getUsers({keyword:p.value.trim(),useYn:"Y",size:10});h.value=m.data.content.filter(r=>!u.existingUserIds.includes(r.userId)),l.value=!0}catch(m){console.error("Failed to search users:",m),x.showError("사용자 검색에 실패했습니다.")}finally{y.value=!1}}function n(m){t.value=m,p.value="",h.value=[],l.value=!1}function s(){t.value=null}function _(){if(!t.value)return;const m={userId:t.value.userId,permission:d.value};i("add",m),t.value=null,d.value="MEMBER"}function w(){setTimeout(()=>{l.value=!1},200)}return(m,r)=>(o(),a("div",O,[r[7]||(r[7]=e("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"사용자 추가",-1)),t.value?(o(),a("div",oe,[e("div",re,[e("div",le,[e("span",ne,v(t.value.userName.charAt(0)),1)]),e("div",ie,[e("div",de,v(t.value.userName),1),e("div",ce,v(t.value.username),1)]),e("button",{type:"button",class:"p-1 text-gray-400 hover:text-gray-600",title:"선택 취소",onClick:s},[...r[5]||(r[5]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),$(U,{modelValue:d.value,"onUpdate:modelValue":r[1]||(r[1]=f=>d.value=f),options:k,label:"권한"},null,8,["modelValue"]),e("button",{type:"button",class:"btn-primary w-full",disabled:!C.value,onClick:_},[...r[6]||(r[6]=[e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"})],-1),S(" 공유 사용자 추가 ",-1)])],8,ue)])):(o(),a("div",P,[e("div",W,[$(j,{modelValue:p.value,"onUpdate:modelValue":r[0]||(r[0]=f=>p.value=f),placeholder:"사용자 이름 또는 아이디로 검색...",clearable:!0,onEnter:E,onBlur:w},null,8,["modelValue"]),e("button",{type:"button",class:"absolute right-2 top-1/2 -translate-y-1/2 p-1 text-gray-400 hover:text-gray-600",disabled:y.value,onClick:E},[y.value?(o(),a("svg",q,[...r[2]||(r[2]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):(o(),a("svg",G,[...r[3]||(r[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"},null,-1)])]))],8,Y),l.value?(o(),a("div",J,[h.value.length===0?(o(),a("div",Q," 검색 결과가 없습니다. ")):B("",!0),(o(!0),a(z,null,R(h.value,f=>(o(),a("button",{key:f.userId,type:"button",class:"w-full px-4 py-2 text-left hover:bg-gray-50 flex items-center gap-3 border-b border-gray-100 last:border-b-0",onClick:Ke=>n(f)},[e("div",Z,[e("span",ee,v(f.userName.charAt(0)),1)]),e("div",null,[e("div",te,v(f.userName),1),e("div",se,v(f.username),1)]),f.departmentName?(o(),a("div",ae,v(f.departmentName),1)):B("",!0)],8,X))),128))])):B("",!0)]),r[4]||(r[4]=e("p",{class:"text-xs text-gray-500"}," 사용자를 검색하여 공유 목록에 추가하세요. ",-1))]))]))}}),ve=I(me,[["__scopeId","data-v-6ebe6148"]]),he={class:"share-user-list-wrapper"},pe={key:0,class:"py-12 text-center"},fe={key:1,class:"py-12 text-center"},xe={key:2,class:"share-table"},ye={class:"flex items-center gap-3"},ge={class:"w-8 h-8 rounded-full bg-primary-100 flex items-center justify-center flex-shrink-0"},_e={class:"text-sm font-medium text-primary-700"},we={class:"font-medium text-gray-900"},be={class:"text-xs text-gray-500"},ke={class:"text-gray-500"},$e=["onClick"],Be=V({__name:"ShareUserList",props:{shares:{},loading:{type:Boolean,default:!1}},emits:["remove"],setup(b,{emit:c}){const u=b,i=c,x=M(()=>u.shares.length===0);function p(l){if(!l)return"-";const t=new Date(l);return isNaN(t.getTime())?"-":t.toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}function h(l){switch(l){case"MEMBER":return{label:"멤버",variant:"primary"};case"VIEWER":return{label:"뷰어",variant:"default"};default:return{label:l,variant:"default"}}}function y(l){i("remove",l)}return(l,t)=>(o(),a("div",he,[b.loading?(o(),a("div",pe,[...t[0]||(t[0]=[e("svg",{class:"animate-spin h-8 w-8 mx-auto text-gray-400",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})],-1),e("p",{class:"mt-2 text-sm text-gray-500"},"공유 사용자를 불러오는 중...",-1)])])):x.value?(o(),a("div",fe,[...t[1]||(t[1]=[e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})],-1),e("p",{class:"mt-2 text-sm text-gray-500"},"공유된 사용자가 없습니다.",-1),e("p",{class:"mt-1 text-xs text-gray-400"},"사용자를 검색하여 공유 목록에 추가하세요.",-1)])])):(o(),a("table",xe,[t[3]||(t[3]=e("thead",null,[e("tr",null,[e("th",{class:"w-[200px]"},"사용자"),e("th",{class:"w-[100px]"},"권한"),e("th",{class:"w-[160px]"},"공유일시"),e("th",{class:"w-[80px]"},"관리")])],-1)),e("tbody",null,[(o(!0),a(z,null,R(b.shares,d=>{var k;return o(),a("tr",{key:d.boardShareId},[e("td",null,[e("div",ye,[e("div",ge,[e("span",_e,v(((k=d.userName)==null?void 0:k.charAt(0))||"?"),1)]),e("div",null,[e("div",we,v(d.userName||"-"),1),e("div",be,"ID: "+v(d.userId),1)])])]),e("td",null,[$(H,{variant:h(d.permission).variant,size:"sm"},{default:F(()=>[S(v(h(d.permission).label),1)]),_:2},1032,["variant"])]),e("td",ke,v(p(d.createdAt)),1),e("td",null,[e("button",{type:"button",class:"action-btn text-red-500 hover:text-red-700 hover:bg-red-50",title:"공유 해제",onClick:C=>y(d)},[...t[2]||(t[2]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7a4 4 0 11-8 0 4 4 0 018 0zM9 14a6 6 0 00-6 6v1h12v-1a6 6 0 00-6-6zM21 12h-6"})],-1)])],8,$e)])])}),128))])]))]))}}),Me=I(Be,[["__scopeId","data-v-82ae86f4"]]),Se={class:"share-users-view"},Ce={class:"board-selector mb-6"},Ee={class:"flex items-center gap-4"},Ve={class:"flex-1 max-w-md"},Ie={key:0,class:"flex items-center gap-2 text-sm text-gray-500"},Ue={key:0,class:"mt-4 p-4 bg-yellow-50 rounded-lg"},Ne={key:0,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},ze={class:"lg:col-span-1"},Re={class:"sticky top-4"},je={class:"lg:col-span-2"},Ae={class:"flex items-center justify-between mb-3"},Fe={class:"text-sm text-gray-500"},Le={class:"font-medium text-gray-900"},Te={class:"table-container"},De={key:1,class:"text-center py-12"},He=V({__name:"ShareUsersView",setup(b){const c=K(),u=N(),i=g(null),x=g(!1),p=g(!1),h=g(!1),y=M(()=>c.ownedBoards.map(n=>({value:n.boardId,label:n.boardName}))),l=M(()=>c.boardShares),t=M(()=>l.value.map(n=>n.userId));async function d(){x.value=!0;try{await c.fetchBoards(),c.ownedBoards.length>0&&!i.value&&(i.value=c.ownedBoards[0].boardId)}catch(n){console.error("Failed to load boards:",n),u.showError("보드 목록을 불러오는데 실패했습니다.")}finally{x.value=!1}}async function k(){if(i.value){p.value=!0;try{await c.fetchBoardShares(i.value)}catch(n){console.error("Failed to load share users:",n),u.showError("공유 사용자 목록을 불러오는데 실패했습니다.")}finally{p.value=!1}}}async function C(n){var s,_;if(i.value){h.value=!0;try{await c.addBoardShare(i.value,n)?u.showSuccess("공유 사용자가 추가되었습니다."):u.showError(c.error||"공유 사용자 추가에 실패했습니다.")}catch(w){console.error("Failed to add share user:",w);const m=((_=(s=w.response)==null?void 0:s.data)==null?void 0:_.message)||"공유 사용자 추가에 실패했습니다.";u.showError(m)}finally{h.value=!1}}}async function E(n){var _,w;if(!(!i.value||!await u.confirm({title:"공유 해제",message:`'${n.userName}' 사용자의 공유를 해제하시겠습니까?`,confirmText:"해제",cancelText:"취소",confirmType:"danger"})))try{await c.removeBoardShare(i.value,n.userId)?u.showSuccess("공유가 해제되었습니다."):u.showError(c.error||"공유 해제에 실패했습니다.")}catch(m){console.error("Failed to remove share user:",m);const r=((w=(_=m.response)==null?void 0:_.data)==null?void 0:w.message)||"공유 해제에 실패했습니다.";u.showError(r)}}return L(i,n=>{n&&k()}),T(()=>{d()}),(n,s)=>(o(),a("div",Se,[s[7]||(s[7]=e("div",{class:"mb-6"},[e("h1",{class:"text-xl font-semibold text-gray-900"},"공유 사용자 관리"),e("p",{class:"mt-1 text-sm text-gray-500"}," 보드별로 공유 사용자를 관리합니다. 공유된 사용자는 해당 보드의 업무를 조회/수정할 수 있습니다. ")],-1)),e("div",Ce,[e("div",Ee,[e("div",Ve,[$(U,{modelValue:i.value,"onUpdate:modelValue":s[0]||(s[0]=_=>i.value=_),options:y.value,label:"보드 선택",placeholder:"공유할 보드를 선택하세요",searchable:!0,disabled:x.value},null,8,["modelValue","options","disabled"])]),x.value?(o(),a("div",Ie,[...s[1]||(s[1]=[e("svg",{class:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})],-1),S(" 보드 목록 로딩중... ",-1)])])):B("",!0)]),!x.value&&y.value.length===0?(o(),a("div",Ue,[...s[2]||(s[2]=[D('<div class="flex items-start gap-3" data-v-4996504c><svg class="w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-4996504c><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" data-v-4996504c></path></svg><div data-v-4996504c><p class="text-sm font-medium text-yellow-800" data-v-4996504c>소유한 보드가 없습니다.</p><p class="mt-1 text-sm text-yellow-700" data-v-4996504c> 공유 사용자를 관리하려면 보드 소유자여야 합니다. </p></div></div>',1)])])):B("",!0)]),i.value?(o(),a("div",Ne,[e("div",ze,[e("div",Re,[$(ve,{"existing-user-ids":t.value,loading:h.value,onAdd:C},null,8,["existing-user-ids","loading"])])]),e("div",je,[e("div",Ae,[s[5]||(s[5]=e("h2",{class:"text-base font-medium text-gray-900"},"공유된 사용자",-1)),e("p",Fe,[s[3]||(s[3]=S(" 총 ",-1)),e("span",Le,v(l.value.length),1),s[4]||(s[4]=S("명 ",-1))])]),e("div",Te,[$(Me,{shares:l.value,loading:p.value,onRemove:E},null,8,["shares","loading"])])])])):!x.value&&y.value.length>0?(o(),a("div",De,[...s[6]||(s[6]=[e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1),e("p",{class:"mt-2 text-sm text-gray-500"},"공유할 보드를 선택하세요.",-1)])])):B("",!0)]))}}),Qe=I(He,[["__scopeId","data-v-4996504c"]]);export{Qe as default};
