import{d as H,r as b,c as R,z as W,A as ye,f as m,g as e,i as D,q as z,F as Y,s as J,I as Q,l as O,X as F,t as V,n as u,x as N,j as x,p as U,k as E,L as ge,m as A,Q as Ee,S as _e,O as De,P as Se,N as ue,w as Le,o as Me}from"./index-D8qsMxsh.js";import{a as he,u as Ve}from"./property-BhXlHRz_.js";import{u as be}from"./board-BqBw7K7S.js";import{u as xe}from"./useToast-BaLNVjwd.js";import{u as ke}from"./useConfirm-tRg9u8MQ.js";import{_ as K}from"./Button.vue_vue_type_script_setup_true_lang-CsKUyp59.js";import{m as Be}from"./MarkdownEditor.vue_vue_type_style_index_0_scoped_f90f4426_lang-Bc65I5vA.js";import{_ as we}from"./Spinner.vue_vue_type_script_setup_true_lang-i4Z96JvV.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as te}from"./Input.vue_vue_type_script_setup_true_lang-DbFXPxNG.js";import{_ as j}from"./Select.vue_vue_type_script_setup_true_lang-CpAO5_7Q.js";import{_ as q}from"./DatePicker.vue_vue_type_script_setup_true_lang-D-7PTvoP.js";const ze={class:"markdown-editor border border-gray-300 rounded-lg overflow-hidden bg-white h-full flex flex-col"},Re={class:"flex items-center justify-between border-b border-gray-200 bg-gray-50 px-2 py-1"},Ue={class:"flex gap-1"},Ne={key:0,class:"flex items-center gap-0.5"},Oe=["title","disabled","onClick"],Pe=["value","placeholder","disabled"],je=["innerHTML"],He=H({__name:"MarkdownEditor",props:{modelValue:{default:""},placeholder:{default:"마크다운 형식으로 내용을 입력하세요..."},disabled:{type:Boolean,default:!1},minHeight:{default:"300px"},autoSaveDelay:{default:1e3}},emits:["update:modelValue","save"],setup(l,{emit:M}){const d=l,p=M,g=b("edit"),s=b(d.modelValue||""),c=b(null),n=b(null),C=R(()=>{if(!s.value)return'<p class="text-gray-400">미리보기할 내용이 없습니다.</p>';try{return Be(s.value,{breaks:!0,gfm:!0})}catch{return'<p class="text-red-500">마크다운 렌더링 오류</p>'}});W(()=>d.modelValue,v=>{v!==s.value&&(s.value=v||"")});function T(v){const w=v.target;s.value=w.value,p("update:modelValue",w.value),n.value&&clearTimeout(n.value),n.value=setTimeout(()=>{p("save",s.value)},d.autoSaveDelay)}function S(){n.value&&(clearTimeout(n.value),n.value=null),p("save",s.value)}function h(v,w){if(!c.value||d.disabled)return;const y=c.value,o=y.selectionStart,r=y.selectionEnd,t=s.value.substring(o,r),a=s.value.substring(0,o)+v+t+w+s.value.substring(r);s.value=a,p("update:modelValue",a),setTimeout(()=>{y.focus(),t?y.setSelectionRange(o+v.length,r+v.length):y.setSelectionRange(o+v.length,o+v.length)},0)}function k(v){if(!c.value||d.disabled)return;const w=c.value,y=w.selectionStart;let o=y;for(;o>0&&s.value[o-1]!==`
`;)o--;const r=s.value.substring(0,o)+v+s.value.substring(o);s.value=r,p("update:modelValue",r),setTimeout(()=>{w.focus(),w.setSelectionRange(y+v.length,y+v.length)},0)}const I=[{icon:"B",action:()=>h("**","**"),title:"굵게 (Ctrl+B)"},{icon:"I",action:()=>h("*","*"),title:"기울임 (Ctrl+I)"},{icon:"~",action:()=>h("~~","~~"),title:"취소선"},{icon:"H1",action:()=>k("# "),title:"제목 1"},{icon:"H2",action:()=>k("## "),title:"제목 2"},{icon:"H3",action:()=>k("### "),title:"제목 3"},{icon:"-",action:()=>k("- "),title:"목록"},{icon:"1.",action:()=>k("1. "),title:"번호 목록"},{icon:"[ ]",action:()=>k("- [ ] "),title:"체크박스"},{icon:"`",action:()=>h("`","`"),title:"인라인 코드"},{icon:"```",action:()=>h("```\n","\n```"),title:"코드 블록"},{icon:">",action:()=>k("> "),title:"인용"},{icon:"---",action:()=>k(`
---
`),title:"구분선"}];function _(v){if(!d.disabled&&(v.ctrlKey||v.metaKey))switch(v.key.toLowerCase()){case"b":v.preventDefault(),h("**","**");break;case"i":v.preventDefault(),h("*","*");break}}return ye(()=>{n.value&&clearTimeout(n.value)}),(v,w)=>(u(),m("div",ze,[e("div",Re,[e("div",Ue,[e("button",{type:"button",class:z(["px-3 py-1.5 text-[12px] font-medium rounded transition-colors",g.value==="edit"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"]),onClick:w[0]||(w[0]=y=>g.value="edit")}," 편집 ",2),e("button",{type:"button",class:z(["px-3 py-1.5 text-[12px] font-medium rounded transition-colors",g.value==="preview"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"]),onClick:w[1]||(w[1]=y=>g.value="preview")}," 미리보기 ",2)]),g.value==="edit"?(u(),m("div",Ne,[(u(),m(Y,null,J(I,y=>e("button",{key:y.icon,type:"button",class:z(["px-1.5 py-1 text-[11px] font-mono text-gray-600 hover:text-gray-900 hover:bg-gray-200 rounded transition-colors",{"opacity-50 cursor-not-allowed":l.disabled}]),title:y.title,disabled:l.disabled,onClick:y.action},V(y.icon),11,Oe)),64))])):D("",!0)]),e("div",{class:"flex-1 min-h-0 overflow-hidden",style:Q({minHeight:l.minHeight})},[O(e("textarea",{ref_key:"textareaRef",ref:c,value:s.value,placeholder:l.placeholder,disabled:l.disabled,class:"w-full h-full p-3 text-[13px] font-mono resize-none focus:outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",onInput:T,onBlur:S,onKeydown:_},null,40,Pe),[[F,g.value==="edit"]]),O(e("div",{class:"prose prose-sm max-w-none p-3 h-full overflow-auto",innerHTML:C.value},null,8,je),[[F,g.value==="preview"]])],4)]))}}),ce=oe(He,[["__scopeId","data-v-f90f4426"]]),Ae={key:4,class:"flex flex-wrap gap-1.5"},Ke=["disabled","onClick"],Fe={key:0,class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},We={key:0,class:"text-[12px] text-gray-400"},Ye={key:5,class:"flex items-center gap-2 cursor-pointer"},Xe=["checked","disabled"],Ge={class:"text-[13px] text-gray-700"},qe={key:7,class:"text-[12px] text-gray-400"},Qe=H({__name:"PropertyEditor",props:{property:{},modelValue:{default:null},disabled:{type:Boolean,default:!1},compact:{type:Boolean,default:!1},users:{default:()=>[]}},emits:["update:modelValue","change"],setup(l,{emit:M}){const d=l,p=M,g=he(),s=b(d.modelValue);W(()=>d.modelValue,o=>{s.value=o},{immediate:!0});const c=R(()=>g.getOptionsByPropertyId(d.property.propertyId).map(r=>({value:r.optionId,label:r.optionName,color:r.color}))),n=R(()=>d.users.map(o=>({value:o.userId,label:o.userName})));function C(o){s.value=o,p("update:modelValue",o),p("change",o)}function T(o){C(o)}function S(o){const r=typeof o=="string"?parseFloat(o)||null:o;C(r)}function h(o){C(o)}function k(o){C(o)}function I(o){const r=Array.isArray(s.value)?[...s.value]:[],t=r.indexOf(o);t!==-1?r.splice(t,1):r.push(o),C(r)}function _(o){const r=o.target;C(r.checked)}function v(o){return Array.isArray(s.value)?s.value.includes(o):!1}function w(o){return o.color?{backgroundColor:`${o.color}20`,color:o.color,borderColor:o.color}:{}}async function y(o){const r=await g.createOption(d.property.propertyId,{optionCode:o.toLowerCase().replace(/\s+/g,"_"),optionName:o});r&&d.property.propertyType==="SELECT"&&C(r.optionId)}return(o,r)=>(u(),m("div",{class:z(["property-editor",{compact:l.compact}])},[l.property.propertyType==="TEXT"?(u(),N(x(te),{key:0,"model-value":String(s.value||""),disabled:l.disabled,size:l.compact?"sm":"md",placeholder:l.property.propertyName,"onUpdate:modelValue":T},null,8,["model-value","disabled","size","placeholder"])):l.property.propertyType==="NUMBER"?(u(),N(x(te),{key:1,"model-value":s.value,type:"number",disabled:l.disabled,size:l.compact?"sm":"md",placeholder:l.property.propertyName,"onUpdate:modelValue":S},null,8,["model-value","disabled","size","placeholder"])):l.property.propertyType==="DATE"?(u(),N(x(q),{key:2,"model-value":s.value,disabled:l.disabled,size:l.compact?"sm":"md",placeholder:l.property.propertyName,mode:"date",clearable:"","onUpdate:modelValue":h},null,8,["model-value","disabled","size","placeholder"])):l.property.propertyType==="SELECT"?(u(),N(x(j),{key:3,"model-value":s.value,options:c.value,disabled:l.disabled,size:l.compact?"sm":"md",placeholder:l.property.propertyName,searchable:"",clearable:"","allow-create":"","onUpdate:modelValue":k,onCreate:y},null,8,["model-value","options","disabled","size","placeholder"])):l.property.propertyType==="MULTI_SELECT"?(u(),m("div",Ae,[(u(!0),m(Y,null,J(x(g).getOptionsByPropertyId(l.property.propertyId),t=>(u(),m("button",{key:t.optionId,type:"button",class:z(["inline-flex items-center gap-1 px-2 py-0.5 text-[12px] rounded-full border transition-colors",[v(t.optionId)?"border-current":"border-gray-200 text-gray-500 hover:border-gray-300"]]),style:Q(v(t.optionId)?w(t):{}),disabled:l.disabled,onClick:a=>I(t.optionId)},[v(t.optionId)?(u(),m("svg",Fe,[...r[0]||(r[0]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):D("",!0),U(" "+V(t.optionName),1)],14,Ke))),128)),c.value.length===0?(u(),m("span",We," 옵션 없음 ")):D("",!0)])):l.property.propertyType==="CHECKBOX"?(u(),m("label",Ye,[e("input",{type:"checkbox",checked:!!s.value,disabled:l.disabled,class:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500 focus:ring-2 cursor-pointer disabled:cursor-not-allowed",onChange:_},null,40,Xe),e("span",Ge,V(l.property.propertyName),1)])):l.property.propertyType==="USER"?(u(),N(x(j),{key:6,"model-value":s.value,options:n.value,disabled:l.disabled,size:l.compact?"sm":"md",placeholder:l.property.propertyName,searchable:"",clearable:"","onUpdate:modelValue":k},null,8,["model-value","options","disabled","size","placeholder"])):(u(),m("div",qe," 지원하지 않는 속성 타입: "+V(l.property.propertyType),1))],2))}}),Je=oe(Qe,[["__scopeId","data-v-4c003d19"]]),Ze={class:"item-form space-y-4"},et={class:"form-section"},tt={class:"grid grid-cols-2 gap-3"},ot={class:"form-section"},lt={class:"form-section"},at={class:"form-section"},st={class:"form-section"},nt={class:"form-section"},rt={class:"form-section"},it={class:"form-section col-span-2"},dt={key:0,class:"pt-3 border-t border-gray-200"},ut={class:"space-y-3"},ct={class:"form-label"},mt={key:0,class:"text-red-500 ml-0.5"},pt=H({__name:"ItemForm",props:{item:{},disabled:{type:Boolean,default:!1}},emits:["update","change"],setup(l,{emit:M}){const d=l,p=M,g=he(),s=be(),c=b({title:d.item.title,content:d.item.content,status:d.item.status,priority:d.item.priority,groupId:d.item.groupId,assigneeId:d.item.assigneeId,startTime:d.item.startTime,endTime:d.item.endTime,dueDate:d.item.dueDate,properties:d.item.propertyValues||{}});W(()=>d.item,t=>{c.value={title:t.title,content:t.content,status:t.status,priority:t.priority,groupId:t.groupId,assigneeId:t.assigneeId,startTime:t.startTime,endTime:t.endTime,dueDate:t.dueDate,properties:t.propertyValues||{}}},{deep:!0});const n=[{value:"NOT_STARTED",label:"시작전",color:"#6B7280"},{value:"IN_PROGRESS",label:"진행중",color:"#3B82F6"},{value:"COMPLETED",label:"완료",color:"#10B981"},{value:"DELETED",label:"삭제",color:"#EF4444"}],C=[{value:"URGENT",label:"긴급",color:"#EF4444"},{value:"HIGH",label:"높음",color:"#F97316"},{value:"NORMAL",label:"보통",color:"#3B82F6"},{value:"LOW",label:"낮음",color:"#6B7280"}],T=R(()=>{const t=s.currentBoard;return t!=null&&t.groups?t.groups.map(a=>({value:a.groupId,label:a.groupName,color:a.color})):[]}),S=R(()=>{const t=s.currentBoard;return t!=null&&t.sharedUsers?t.sharedUsers.map(a=>({value:a.userId,label:a.userName})):[]}),h=R(()=>g.sortedProperties.filter(t=>t.systemYn!=="Y"));function k(t,a){c.value[t]=a,p("change",t,a),p("update",c.value)}function I(t){k("status",t)}function _(t){k("priority",t)}function v(t){k("groupId",t)}function w(t){k("assigneeId",t)}function y(t,a){k(t,a||void 0)}function o(t,a){const $={...c.value.properties,[t]:a};c.value.properties=$,p("change",`property_${t}`,a),p("update",c.value)}function r(t){var a;return((a=c.value.properties)==null?void 0:a[t])??null}return(t,a)=>(u(),m("div",Ze,[e("div",et,[a[4]||(a[4]=e("label",{class:"form-label"},"제목",-1)),E(x(te),{"model-value":c.value.title,disabled:l.disabled,placeholder:"업무 제목을 입력하세요","onUpdate:modelValue":a[0]||(a[0]=$=>k("title",$))},null,8,["model-value","disabled"])]),e("div",tt,[e("div",ot,[a[5]||(a[5]=e("label",{class:"form-label"},"상태",-1)),E(x(j),{"model-value":c.value.status,options:n,disabled:l.disabled,placeholder:"상태 선택","onUpdate:modelValue":I},null,8,["model-value","disabled"])]),e("div",lt,[a[6]||(a[6]=e("label",{class:"form-label"},"우선순위",-1)),E(x(j),{"model-value":c.value.priority,options:C,disabled:l.disabled,placeholder:"우선순위 선택","onUpdate:modelValue":_},null,8,["model-value","disabled"])]),e("div",at,[a[7]||(a[7]=e("label",{class:"form-label"},"그룹",-1)),E(x(j),{"model-value":c.value.groupId,options:T.value,disabled:l.disabled,placeholder:"그룹 선택",clearable:"","onUpdate:modelValue":v},null,8,["model-value","options","disabled"])]),e("div",st,[a[8]||(a[8]=e("label",{class:"form-label"},"담당자",-1)),E(x(j),{"model-value":c.value.assigneeId,options:S.value,disabled:l.disabled,placeholder:"담당자 선택",searchable:"",clearable:"","onUpdate:modelValue":w},null,8,["model-value","options","disabled"])]),e("div",nt,[a[9]||(a[9]=e("label",{class:"form-label"},"시작일",-1)),E(x(q),{"model-value":c.value.startTime,disabled:l.disabled,mode:"datetime",placeholder:"시작일 선택",clearable:"","onUpdate:modelValue":a[1]||(a[1]=$=>y("startTime",$))},null,8,["model-value","disabled"])]),e("div",rt,[a[10]||(a[10]=e("label",{class:"form-label"},"완료일",-1)),E(x(q),{"model-value":c.value.endTime,disabled:l.disabled,mode:"datetime",placeholder:"완료일 선택",clearable:"","onUpdate:modelValue":a[2]||(a[2]=$=>y("endTime",$))},null,8,["model-value","disabled"])]),e("div",it,[a[11]||(a[11]=e("label",{class:"form-label"},"마감일",-1)),E(x(q),{"model-value":c.value.dueDate,disabled:l.disabled,mode:"date",placeholder:"마감일 선택",clearable:"","onUpdate:modelValue":a[3]||(a[3]=$=>y("dueDate",$))},null,8,["model-value","disabled"])])]),h.value.length>0?(u(),m("div",dt,[a[12]||(a[12]=e("h4",{class:"text-[12px] font-medium text-gray-500 uppercase tracking-wide mb-3"}," 추가 속성 ",-1)),e("div",ut,[(u(!0),m(Y,null,J(h.value,$=>(u(),m("div",{key:$.propertyId,class:"form-section"},[e("label",ct,[U(V($.propertyName)+" ",1),$.requiredYn==="Y"?(u(),m("span",mt,"*")):D("",!0)]),E(x(Je),{property:$,"model-value":r($.propertyId),disabled:l.disabled,users:S.value.map(B=>({userId:Number(B.value),userName:B.label})),"onUpdate:modelValue":B=>o($.propertyId,B)},null,8,["property","model-value","disabled","users","onUpdate:modelValue"])]))),128))])])):D("",!0)]))}}),me=oe(pt,[["__scopeId","data-v-86c42677"]]),vt={class:"flex gap-2 items-end"},ft={class:"flex-1 relative"},yt=["placeholder","disabled","autofocus"],gt=H({__name:"CommentInput",props:{placeholder:{default:"댓글을 입력하세요..."},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},autofocus:{type:Boolean,default:!1}},emits:["submit"],setup(l,{expose:M,emit:d}){const p=l,g=d,s=b(""),c=b(null),n=R(()=>s.value.trim().length>0);function C(){!n.value||p.loading||p.disabled||(g("submit",s.value.trim()),s.value="",c.value&&(c.value.style.height="auto"))}function T(I){I.key==="Enter"&&!I.shiftKey&&(I.preventDefault(),C())}function S(){c.value&&(c.value.style.height="auto",c.value.style.height=`${Math.min(c.value.scrollHeight,120)}px`)}function h(){var I;(I=c.value)==null||I.focus()}function k(){s.value="",c.value&&(c.value.style.height="auto")}return M({focus:h,clear:k}),(I,_)=>(u(),m("div",vt,[e("div",ft,[O(e("textarea",{ref_key:"textareaRef",ref:c,"onUpdate:modelValue":_[0]||(_[0]=v=>s.value=v),placeholder:l.placeholder,disabled:l.disabled||l.loading,autofocus:l.autofocus,rows:"1",class:"w-full px-3 py-2 text-[13px] border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",style:{"min-height":"38px","max-height":"120px"},onInput:S,onKeydown:T},null,40,yt),[[ge,s.value]])]),E(x(K),{size:"sm",loading:l.loading,disabled:!n.value||l.disabled,onClick:C},{default:A(()=>[..._[1]||(_[1]=[U(" 등록 ",-1)])]),_:1},8,["loading","disabled"])]))}}),G={getComments(l){return Se(`/items/${l}/comments`)},createComment(l,M){return De(`/items/${l}/comments`,M)},updateComment(l,M){return _e(`/comments/${l}`,M)},deleteComment(l){return Ee(`/comments/${l}`)}},ht={class:"flex flex-col h-full"},bt={class:"flex items-center justify-between pb-3 border-b border-gray-200"},xt={class:"text-[14px] font-medium text-gray-900"},kt={key:0,class:"text-gray-500 font-normal"},wt={class:"flex-1 overflow-y-auto py-3 space-y-3"},Ct={key:0,class:"flex items-center justify-center py-8"},It={key:1,class:"text-center py-8"},$t={class:"flex items-center justify-between mb-1"},Tt={class:"flex items-center gap-2"},Et={class:"w-6 h-6 rounded-full bg-primary-100 flex items-center justify-center"},_t={class:"text-[11px] font-medium text-primary-700"},Dt={class:"text-[13px] font-medium text-gray-900"},St={class:"text-[12px] text-gray-400"},Lt={key:0,class:"text-[11px] text-gray-400"},Mt={class:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},Vt=["onClick"],Bt=["onClick"],zt={class:"pl-8"},Rt={key:0,class:"space-y-2"},Ut=["onKeydown"],Nt={class:"flex justify-end gap-2"},Ot=["onClick"],Pt={key:1,class:"text-[13px] text-gray-700 whitespace-pre-wrap break-words"},jt={class:"pt-3 border-t border-gray-200"},pe=H({__name:"CommentList",props:{itemId:{}},setup(l,{expose:M}){const d=l,p=xe(),g=ke(),s=b([]),c=b(!1),n=b(!1),C=b(null),T=b(""),S=R(()=>s.value.length);async function h(){if(d.itemId){c.value=!0;try{const o=await G.getComments(d.itemId);o.success&&o.data&&(s.value=o.data)}catch{p.error("댓글을 불러오는데 실패했습니다.")}finally{c.value=!1}}}async function k(o){if(d.itemId){n.value=!0;try{const r=await G.createComment(d.itemId,{content:o});r.success&&r.data?(s.value.push(r.data),p.success("댓글이 등록되었습니다.")):p.error(r.message||"댓글 등록에 실패했습니다.")}catch{p.error("댓글 등록에 실패했습니다.")}finally{n.value=!1}}}function I(o){C.value=o.commentId,T.value=o.content}function _(){C.value=null,T.value=""}async function v(o){if(!T.value.trim()){p.warning("내용을 입력해주세요.");return}try{const r=await G.updateComment(o,{content:T.value.trim()});if(r.success&&r.data){const t=s.value.findIndex(a=>a.commentId===o);t!==-1&&(s.value[t]=r.data),p.success("댓글이 수정되었습니다."),_()}else p.error(r.message||"댓글 수정에 실패했습니다.")}catch{p.error("댓글 수정에 실패했습니다.")}}async function w(o){if(await g.show({title:"댓글 삭제",message:"이 댓글을 삭제하시겠습니까?",confirmText:"삭제",confirmType:"danger"}))try{const t=await G.deleteComment(o);t.success?(s.value=s.value.filter(a=>a.commentId!==o),p.success("댓글이 삭제되었습니다.")):p.error(t.message||"댓글 삭제에 실패했습니다.")}catch{p.error("댓글 삭제에 실패했습니다.")}}function y(o){const r=new Date(o),a=new Date().getTime()-r.getTime(),$=Math.floor(a/(1e3*60)),B=Math.floor(a/(1e3*60*60)),X=Math.floor(a/(1e3*60*60*24));return $<1?"방금 전":$<60?`${$}분 전`:B<24?`${B}시간 전`:X<7?`${X}일 전`:r.toLocaleDateString("ko-KR",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}return W(()=>d.itemId,()=>{h()},{immediate:!0}),M({commentCount:S,refresh:h}),(o,r)=>(u(),m("div",ht,[e("div",bt,[e("h3",xt,[r[1]||(r[1]=U(" 댓글 ",-1)),S.value>0?(u(),m("span",kt," ("+V(S.value)+") ",1)):D("",!0)])]),e("div",wt,[c.value?(u(),m("div",Ct,[E(x(we),{size:"md"})])):s.value.length===0?(u(),m("div",It,[...r[2]||(r[2]=[e("svg",{class:"w-10 h-10 mx-auto text-gray-300 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1),e("p",{class:"text-[13px] text-gray-500"},"댓글이 없습니다.",-1)])])):(u(!0),m(Y,{key:2},J(s.value,t=>(u(),m("div",{key:t.commentId,class:"group"},[e("div",$t,[e("div",Tt,[e("div",Et,[e("span",_t,V((t.createdByName||"?").charAt(0)),1)]),e("span",Dt,V(t.createdByName||"알 수 없음"),1),e("span",St,V(y(t.createdAt)),1),t.edited?(u(),m("span",Lt," (수정됨) ")):D("",!0)]),e("div",Mt,[C.value!==t.commentId?(u(),m("button",{key:0,class:"p-1 text-gray-400 hover:text-gray-600 rounded",title:"수정",onClick:a=>I(t)},[...r[3]||(r[3]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})],-1)])],8,Vt)):D("",!0),e("button",{class:"p-1 text-gray-400 hover:text-red-500 rounded",title:"삭제",onClick:a=>w(t.commentId)},[...r[4]||(r[4]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Bt)])]),e("div",zt,[C.value===t.commentId?(u(),m("div",Rt,[O(e("textarea",{"onUpdate:modelValue":r[0]||(r[0]=a=>T.value=a),class:"w-full px-3 py-2 text-[13px] border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",rows:"2",onKeydown:[ue(Le(a=>v(t.commentId),["exact","prevent"]),["enter"]),ue(_,["escape"])]},null,40,Ut),[[ge,T.value]]),e("div",Nt,[e("button",{class:"px-2.5 py-1 text-[12px] text-gray-600 hover:bg-gray-100 rounded transition-colors",onClick:_}," 취소 "),e("button",{class:"px-2.5 py-1 text-[12px] text-white bg-primary-500 hover:bg-primary-600 rounded transition-colors",onClick:a=>v(t.commentId)}," 저장 ",8,Ot)])])):(u(),m("p",Pt,V(t.content),1))])]))),128))]),e("div",jt,[E(gt,{loading:n.value,onSubmit:k},null,8,["loading"])])]))}}),Ht={class:"item-detail-panel h-full flex flex-col bg-white"},At={class:"flex-shrink-0 px-4 py-3 border-b border-gray-200"},Kt={class:"flex items-center justify-between"},Ft={class:"flex items-center gap-2"},Wt={class:"flex items-center gap-1"},Yt={key:0,class:"text-[12px] text-gray-400 mr-2"},Xt={key:0,class:"mt-2 text-[11px] text-gray-400"},Gt={key:0,class:"flex-shrink-0 border-b border-gray-200"},qt={class:"flex"},Qt={key:0,class:"ml-1 px-1.5 py-0.5 text-[10px] rounded-full bg-gray-100"},Jt={class:"flex-1 min-h-0 overflow-hidden"},Zt={key:0,class:"h-full flex items-center justify-center"},eo={key:1,class:"h-full flex items-center justify-center"},to={class:"flex-1 min-w-0 overflow-hidden p-4 flex flex-col"},oo={class:"flex-1 min-h-0"},lo={class:"h-full overflow-y-auto p-4"},ao={class:"h-full overflow-y-auto p-4"},so={class:"h-full overflow-y-auto p-4"},no={key:1,class:"flex-shrink-0 px-4 py-3 border-t border-gray-200 bg-white"},ro={class:"flex gap-2"},ve="taskflow_prop_width",fe="taskflow_comment_width",ko=H({__name:"ItemDetailPanel",props:{itemId:{},boardId:{}},emits:["close","updated","deleted"],setup(l,{emit:M}){const d=l,p=M,g=Ve();be();const s=xe(),c=ke(),n=b(null),C=b(!1),T=b(!1),S=b(!1),h=b("detail"),k=b(null),I=b(""),_=b(240),v=b(280),w=b(!1),y=b(!1),o=b(null);function r(){const f=localStorage.getItem(ve),i=localStorage.getItem(fe);f&&(_.value=Math.max(180,Math.min(400,parseInt(f,10)))),i&&(v.value=Math.max(200,Math.min(450,parseInt(i,10))))}function t(){localStorage.setItem(ve,_.value.toString()),localStorage.setItem(fe,v.value.toString())}function a(f){f.preventDefault(),w.value=!0,document.body.style.cursor="ew-resize",document.body.style.userSelect="none",document.addEventListener("mousemove",$),document.addEventListener("mouseup",B)}function $(f){if(!w.value||!o.value)return;const i=o.value.getBoundingClientRect(),L=f.clientX-i.left;_.value=Math.max(180,Math.min(400,L))}function B(){w.value=!1,document.body.style.cursor="",document.body.style.userSelect="",t(),document.removeEventListener("mousemove",$),document.removeEventListener("mouseup",B)}function X(f){f.preventDefault(),y.value=!0,document.body.style.cursor="ew-resize",document.body.style.userSelect="none",document.addEventListener("mousemove",le),document.addEventListener("mouseup",ae)}function le(f){if(!y.value||!o.value)return;const L=o.value.getBoundingClientRect().right-f.clientX;v.value=Math.max(200,Math.min(450,L))}function ae(){y.value=!1,document.body.style.cursor="",document.body.style.userSelect="",t(),document.removeEventListener("mousemove",le),document.removeEventListener("mouseup",ae)}const Z=R(()=>n.value?{name:n.value.updatedByName||n.value.createdByName||"알 수 없음",time:$e(n.value.updatedAt||n.value.createdAt)}:null),se=R(()=>{var f;return((f=n.value)==null?void 0:f.commentCount)||0});async function Ce(){if(!(!d.itemId||!d.boardId)){C.value=!0;try{const f=await g.fetchItem(d.boardId,d.itemId);f?(n.value=f,I.value=f.description||"",g.startEditing(d.itemId,f)):(s.error("업무를 불러오는데 실패했습니다."),p("close"))}catch{s.error("업무를 불러오는데 실패했습니다."),p("close")}finally{C.value=!1}}}async function ne(f){if(!n.value||!d.boardId)return;S.value=!0,T.value=!0;const i={...f};g.updateEditingData(i);try{const L=await g.updateItem(d.boardId,n.value.itemId,i);if(L){const Te=I.value;n.value=L,L.description!==Te&&(I.value=L.description||""),S.value=!1,p("updated",L)}else s.error("저장에 실패했습니다.")}catch{s.error("저장에 실패했습니다.")}finally{T.value=!1}}async function re(f){if(!(!n.value||!d.boardId)&&f!==n.value.description){S.value=!0,T.value=!0;try{const i=await g.updateItem(d.boardId,n.value.itemId,{description:f});i?(n.value=i,S.value=!1,p("updated",i)):s.error("내용 저장에 실패했습니다.")}catch{s.error("내용 저장에 실패했습니다.")}finally{T.value=!1}}}async function ie(){if(!n.value||!d.boardId)return;await c.show({title:"완료 처리",message:"이 업무를 완료 처리하시겠습니까?",confirmText:"완료",confirmType:"primary"})&&(await g.completeItem(d.boardId,n.value.itemId)?(s.success("완료 처리되었습니다."),n.value={...n.value,status:"COMPLETED"},p("updated",n.value)):s.error("완료 처리에 실패했습니다."))}async function Ie(){if(!n.value||!d.boardId)return;await c.show({title:"업무 삭제",message:"이 업무를 삭제하시겠습니까?",confirmText:"삭제",confirmType:"danger"})&&(await g.deleteItem(d.boardId,n.value.itemId)?(s.success("삭제되었습니다."),p("deleted",n.value.itemId),p("close")):s.error("삭제에 실패했습니다."))}function ee(){g.stopEditing(),p("close")}function $e(f){return f?new Date(f).toLocaleDateString("ko-KR",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}W(()=>d.itemId,()=>{Ce()},{immediate:!0});const P=b(window.innerWidth<768);function de(){P.value=window.innerWidth<768}return Me(()=>{window.addEventListener("resize",de),r()}),ye(()=>{window.removeEventListener("resize",de),g.stopEditing()}),(f,i)=>(u(),m("div",Ht,[e("div",At,[e("div",Kt,[e("div",Ft,[P.value?(u(),m("button",{key:0,class:"p-1 -ml-1 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded",onClick:ee},[...i[5]||(i[5]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])])):D("",!0),i[6]||(i[6]=e("h2",{class:"text-[15px] font-semibold text-gray-900"},"업무 상세",-1))]),e("div",Wt,[T.value?(u(),m("span",Yt,"저장 중...")):D("",!0),n.value&&n.value.status!=="COMPLETED"&&n.value.status!=="DELETED"?(u(),N(x(K),{key:1,variant:"ghost",size:"sm",onClick:ie},{default:A(()=>[...i[7]||(i[7]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),U(" 완료 ",-1)])]),_:1})):D("",!0),n.value&&n.value.status!=="DELETED"?(u(),N(x(K),{key:2,variant:"ghost",size:"sm",class:"text-red-600 hover:text-red-700 hover:bg-red-50",onClick:Ie},{default:A(()=>[...i[8]||(i[8]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),U(" 삭제 ",-1)])]),_:1})):D("",!0),P.value?D("",!0):(u(),m("button",{key:3,class:"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded",onClick:ee},[...i[9]||(i[9]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]))])]),Z.value?(u(),m("div",Xt,V(Z.value.name)+"님이 "+V(Z.value.time)+"에 수정 ",1)):D("",!0)]),P.value?(u(),m("div",Gt,[e("div",qt,[e("button",{class:z(["flex-1 px-3 py-2.5 text-[13px] font-medium",h.value==="detail"?"text-primary-600 border-b-2 border-primary-600":"text-gray-500"]),onClick:i[0]||(i[0]=L=>h.value="detail")},"속성",2),e("button",{class:z(["flex-1 px-3 py-2.5 text-[13px] font-medium",h.value==="content"?"text-primary-600 border-b-2 border-primary-600":"text-gray-500"]),onClick:i[1]||(i[1]=L=>h.value="content")},"내용",2),e("button",{class:z(["flex-1 px-3 py-2.5 text-[13px] font-medium relative",h.value==="comments"?"text-primary-600 border-b-2 border-primary-600":"text-gray-500"]),onClick:i[2]||(i[2]=L=>h.value="comments")},[i[10]||(i[10]=U(" 댓글 ",-1)),se.value>0?(u(),m("span",Qt,V(se.value),1)):D("",!0)],2)])])):D("",!0),e("div",Jt,[C.value?(u(),m("div",Zt,[E(x(we),{size:"lg"})])):n.value?P.value?(u(),m(Y,{key:3},[O(e("div",lo,[E(me,{item:n.value,disabled:n.value.status==="DELETED",onUpdate:ne},null,8,["item","disabled"])],512),[[F,h.value==="detail"]]),O(e("div",ao,[E(x(ce),{modelValue:I.value,"onUpdate:modelValue":i[4]||(i[4]=L=>I.value=L),disabled:n.value.status==="DELETED",placeholder:"마크다운 형식으로 상세 내용을 입력하세요...","min-height":"calc(100vh - 250px)",onSave:re},null,8,["modelValue","disabled"])],512),[[F,h.value==="content"]]),O(e("div",so,[E(x(pe),{ref_key:"commentListRef",ref:k,"item-id":l.itemId},null,8,["item-id"])],512),[[F,h.value==="comments"]])],64)):(u(),m("div",{key:2,ref_key:"containerRef",ref:o,class:"h-full flex"},[e("div",{class:"flex-shrink-0 overflow-y-auto p-3 bg-gray-50",style:Q({width:`${_.value}px`})},[E(me,{item:n.value,disabled:n.value.status==="DELETED",onUpdate:ne},null,8,["item","disabled"])],4),e("div",{class:z(["w-2 flex-shrink-0 bg-gray-200 hover:bg-primary-300 cursor-ew-resize flex items-center justify-center group",{"bg-primary-400":w.value}]),onMousedown:a},[...i[12]||(i[12]=[e("div",{class:"flex flex-col gap-0.5"},[e("div",{class:"w-0.5 h-4 bg-gray-400 group-hover:bg-primary-600 rounded-full"})],-1)])],34),e("div",to,[i[13]||(i[13]=e("label",{class:"text-[12px] font-medium text-gray-600 mb-2 flex-shrink-0"},"내용",-1)),e("div",oo,[E(x(ce),{modelValue:I.value,"onUpdate:modelValue":i[3]||(i[3]=L=>I.value=L),disabled:n.value.status==="DELETED",placeholder:"마크다운 형식으로 상세 내용을 입력하세요...","min-height":"100%",onSave:re},null,8,["modelValue","disabled"])])]),e("div",{class:z(["w-2 flex-shrink-0 bg-gray-200 hover:bg-primary-300 cursor-ew-resize flex items-center justify-center group",{"bg-primary-400":y.value}]),onMousedown:X},[...i[14]||(i[14]=[e("div",{class:"flex flex-col gap-0.5"},[e("div",{class:"w-0.5 h-4 bg-gray-400 group-hover:bg-primary-600 rounded-full"})],-1)])],34),e("div",{class:"flex-shrink-0 overflow-y-auto p-3 bg-gray-50",style:Q({width:`${v.value}px`})},[E(x(pe),{ref_key:"commentListRef",ref:k,"item-id":l.itemId},null,8,["item-id"])],4)],512)):(u(),m("div",eo,[...i[11]||(i[11]=[e("p",{class:"text-[14px] text-gray-500"},"업무를 찾을 수 없습니다.",-1)])]))]),P.value&&n.value&&n.value.status!=="DELETED"?(u(),m("div",no,[e("div",ro,[n.value.status!=="COMPLETED"?(u(),N(x(K),{key:0,variant:"primary",class:"flex-1",onClick:ie},{default:A(()=>[...i[15]||(i[15]=[U("완료 처리",-1)])]),_:1})):D("",!0),E(x(K),{variant:"outline",class:"flex-1",onClick:ee},{default:A(()=>[...i[16]||(i[16]=[U("닫기",-1)])]),_:1})])])):D("",!0)]))}});export{ko as _};
