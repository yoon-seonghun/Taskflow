import{u as N,r as i,c as y,a as C,b as k,d as M,e as F,o as $,f as U,g as o,h as j,i as E,j as g,t as V,w as B,k as T,l as D,v as K,m as R,n as L,p as q}from"./index-D8qsMxsh.js";import{u as P}from"./useToast-BaLNVjwd.js";import{_ as H}from"./Button.vue_vue_type_script_setup_true_lang-CsKUyp59.js";import{_ as S}from"./Input.vue_vue_type_script_setup_true_lang-DbFXPxNG.js";function O(){const b=C(),s=N(),v=P(),u=i(null),n=i(!1),a=i(!1),c=y(()=>s.isAuthenticated),h=y(()=>s.user),d=y(()=>s.currentUserId),f=y(()=>s.currentUserName),_=y(()=>s.initialized);async function A(e){u.value=null,n.value=!0,s.setLoading(!0);try{const l=await k.login(e);if(l.success&&l.data){const{accessToken:x,user:I}=l.data;return s.setAuth(x,I),v.success(`${I.userName}님, 환영합니다!`),await b.push({name:"Tasks"}),!0}else return u.value=l.message||"로그인에 실패했습니다.",!1}catch(l){const x=l instanceof Error?l.message:"로그인 중 오류가 발생했습니다.";return u.value=x,v.error(x),!1}finally{n.value=!1,s.setLoading(!1)}}async function w(){a.value=!0;try{await k.logout()}catch(e){console.error("Logout API error:",e)}finally{s.clearAuth(),a.value=!1,await b.push({name:"Login"}),v.info("로그아웃되었습니다.")}}async function p(){try{const e=await k.refresh();return e.success&&e.data?(s.setToken(e.data.accessToken),!0):!1}catch(e){return console.error("Token refresh failed:",e),!1}}async function t(){if(!s.accessToken)return!1;try{const e=await k.getCurrentUser();return e.success&&e.data?(s.setUser(e.data),!0):!1}catch(e){return console.error("Fetch current user failed:",e),!1}}async function r(){if(!s.initialized){s.setLoading(!0);try{if(s.accessToken){if(s.needsTokenRefresh()&&!await p()){s.clearAuth();return}await t()||s.clearAuth()}}catch(e){console.error("Auth initialization failed:",e),s.clearAuth()}finally{s.setInitialized(!0),s.setLoading(!1)}}}async function m(){return await p()?!0:(s.clearAuth(),await b.push({name:"Login",query:{expired:"true"}}),v.warning("세션이 만료되었습니다. 다시 로그인해주세요."),!1)}function z(e){return e.length<8?{valid:!1,message:"비밀번호는 최소 8자 이상이어야 합니다."}:/[A-Z]/.test(e)?/[a-z]/.test(e)?/[0-9]/.test(e)?/[!@#$%^&*]/.test(e)?{valid:!0,message:""}:{valid:!1,message:"비밀번호에 특수문자(!@#$%^&*)가 포함되어야 합니다."}:{valid:!1,message:"비밀번호에 숫자가 포함되어야 합니다."}:{valid:!1,message:"비밀번호에 소문자가 포함되어야 합니다."}:{valid:!1,message:"비밀번호에 대문자가 포함되어야 합니다."}}return{loginError:u,isLoggingIn:n,isLoggingOut:a,isAuthenticated:c,currentUser:h,currentUserId:d,currentUserName:f,isInitialized:_,login:A,logout:w,refreshToken:p,fetchCurrentUser:t,initializeAuth:r,handleTokenExpired:m,validatePassword:z}}const Y={class:"min-h-screen flex items-center justify-center bg-gray-100 px-4"},Z={class:"w-full max-w-sm"},G={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},J={key:0,class:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg text-yellow-700 text-sm"},Q={key:1,class:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm"},W={class:"mb-4"},X={class:"mb-4"},ee={class:"mb-6"},se={class:"flex items-center gap-2 cursor-pointer"},te={class:"text-center text-xs text-gray-400 mt-6"},le=M({__name:"LoginView",setup(b){const s=F(),{login:v,loginError:u,isLoggingIn:n}=O(),a=i(""),c=i(""),h=i(!1),d=i(""),f=i(""),_=y(()=>s.query.expired==="true");function A(){let t=!0;return a.value.trim()?a.value.length<4?(d.value="아이디는 4자 이상이어야 합니다.",t=!1):d.value="":(d.value="아이디를 입력해주세요.",t=!1),c.value?c.value.length<8?(f.value="비밀번호는 8자 이상이어야 합니다.",t=!1):f.value="":(f.value="비밀번호를 입력해주세요.",t=!1),t}async function w(){A()&&(h.value?localStorage.setItem("savedUsername",a.value.trim()):localStorage.removeItem("savedUsername"),await v({username:a.value.trim(),password:c.value}))}function p(t){t.key==="Enter"&&w()}return $(()=>{const t=localStorage.getItem("savedUsername");t&&(a.value=t,h.value=!0)}),(t,r)=>(L(),U("div",Y,[o("div",Z,[r[4]||(r[4]=j('<div class="text-center mb-8"><div class="inline-flex items-center justify-center w-16 h-16 bg-primary-600 rounded-xl mb-4"><svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg></div><h1 class="text-2xl font-bold text-gray-900">TaskFlow</h1><p class="text-sm text-gray-500 mt-1">업무 관리 시스템</p></div>',1)),o("div",G,[_.value?(L(),U("div",J," 세션이 만료되었습니다. 다시 로그인해주세요. ")):E("",!0),g(u)?(L(),U("div",Q,V(g(u)),1)):E("",!0),o("form",{onSubmit:B(w,["prevent"])},[o("div",W,[T(S,{modelValue:a.value,"onUpdate:modelValue":r[0]||(r[0]=m=>a.value=m),type:"text",label:"아이디",placeholder:"아이디를 입력하세요",error:!!d.value,"error-message":d.value,disabled:g(n),autofocus:"",onKeydown:p},null,8,["modelValue","error","error-message","disabled"])]),o("div",X,[T(S,{modelValue:c.value,"onUpdate:modelValue":r[1]||(r[1]=m=>c.value=m),type:"password",label:"비밀번호",placeholder:"비밀번호를 입력하세요",error:!!f.value,"error-message":f.value,disabled:g(n),onKeydown:p},null,8,["modelValue","error","error-message","disabled"])]),o("div",ee,[o("label",se,[D(o("input",{"onUpdate:modelValue":r[2]||(r[2]=m=>h.value=m),type:"checkbox",class:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"},null,512),[[K,h.value]]),r[3]||(r[3]=o("span",{class:"text-sm text-gray-600"},"아이디 저장",-1))])]),T(H,{type:"submit",variant:"primary",size:"lg",block:"",loading:g(n),disabled:g(n)},{default:R(()=>[q(V(g(n)?"로그인 중...":"로그인"),1)]),_:1},8,["loading","disabled"])],32)]),o("p",te," © "+V(new Date().getFullYear())+" TaskFlow. All rights reserved. ",1)])]))}});export{le as default};
