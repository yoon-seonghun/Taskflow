import{d as E,r as n,c as G,z as L,o as O,f as i,h as U,g as t,t as a,k as y,j as u,x as F,F as C,i as N,s as W,q,w as P,m as K,p as J,n as l}from"./index-D8qsMxsh.js";import{i as _}from"./item-CAonLf5Y.js";import{u as Q}from"./board-BqBw7K7S.js";import{u as X}from"./useSlideOver-DM1nQhnY.js";import{u as Y}from"./useToast-BaLNVjwd.js";import{u as Z}from"./useConfirm-tRg9u8MQ.js";import{_ as tt}from"./Select.vue_vue_type_script_setup_true_lang-CpAO5_7Q.js";import"./MarkdownEditor.vue_vue_type_style_index_0_scoped_f90f4426_lang-Bc65I5vA.js";import{_ as et}from"./Spinner.vue_vue_type_script_setup_true_lang-i4Z96JvV.js";import{_ as st}from"./Badge.vue_vue_type_script_setup_true_lang-BICiYF9q.js";import{_ as ot}from"./EmptyState.vue_vue_type_script_setup_true_lang-DF03tBGG.js";import{_ as at}from"./Pagination.vue_vue_type_script_setup_true_lang-D8QDOFFt.js";const rt={class:"h-full flex flex-col"},nt={class:"grid grid-cols-2 sm:grid-cols-4 gap-4 mb-4"},lt={class:"bg-white rounded-lg border border-gray-200 p-4"},it={class:"text-2xl font-bold text-yellow-600"},dt={class:"bg-white rounded-lg border border-gray-200 p-4"},ct={class:"text-2xl font-bold text-gray-700"},pt={class:"bg-white rounded-lg border border-gray-200 p-4"},ut={class:"text-2xl font-bold text-orange-500"},xt={class:"bg-white rounded-lg border border-gray-200 p-4"},gt={class:"text-2xl font-bold text-red-500"},mt={class:"bg-white rounded-lg border border-gray-200 p-4 mb-4"},ft={class:"flex flex-wrap items-center gap-4"},ht={class:"flex items-center gap-2"},vt={class:"ml-auto text-sm text-gray-500"},yt={class:"flex-1 bg-white rounded-lg border border-gray-200 overflow-hidden flex flex-col"},_t={key:0,class:"flex-1 flex items-center justify-center"},bt={class:"flex-1 overflow-auto"},wt={class:"w-full"},kt={class:"divide-y divide-gray-100"},It=["onClick"],Ct={class:"px-4 h-12"},Nt={class:"flex items-center gap-1.5"},Pt={class:"px-4 h-12"},Dt={class:"flex items-center gap-2"},Vt=["title"],At=["onClick"],Bt={key:0,class:"px-1.5 py-0.5 text-[11px] bg-gray-100 text-gray-500 rounded flex-shrink-0"},Ht={class:"px-4 h-12"},Tt={class:"px-4 h-12 text-[13px] text-gray-600 whitespace-nowrap"},$t={class:"flex items-center gap-2"},zt={class:"w-6 h-6 rounded-full bg-primary-100 text-primary-600 flex items-center justify-center text-[11px] font-medium"},Mt={class:"px-4 h-12 text-[13px] text-gray-600 whitespace-nowrap"},Rt={class:"flex items-center justify-center gap-1"},St=["onClick"],jt=["onClick"],Et=["onClick"],Gt={key:0,class:"flex-shrink-0 border-t border-gray-200 px-4 py-3"},ee=E({__name:"PendingView",setup(Lt){const k=Q(),{openItemDetail:D}=X(),r=Y(),V=Z(),b=n(!1),c=n([]),x=n(null),g=n(0),A=n(20),m=n(0),w=n(0),p=n({total:0,avgDays:0,longPending:0,urgentHigh:0}),B=G(()=>[{value:null,label:"전체 보드"},...k.activeBoards.map(s=>({value:s.boardId,label:s.boardName}))]);async function d(){b.value=!0;try{await k.fetchBoards();const s={boardId:x.value||void 0,page:g.value,size:A.value,sort:"updatedAt,desc"},e=await _.getPendingItems(s);e.success&&e.data?(c.value=e.data.content,m.value=e.data.totalElements,w.value=e.data.totalPages,H()):r.error("데이터를 불러오는데 실패했습니다.")}catch{r.error("데이터를 불러오는데 실패했습니다.")}finally{b.value=!1}}function H(){const s=c.value,e=s.map(o=>f(o));p.value={total:m.value,avgDays:e.length>0?Math.round(e.reduce((o,h)=>o+h,0)/e.length):0,longPending:e.filter(o=>o>=7).length,urgentHigh:s.filter(o=>o.priority==="URGENT"||o.priority==="HIGH").length}}function I(s){D(s.itemId,s.boardId)}async function T(s){try{(await _.updateItem(s.boardId,s.itemId,{status:"IN_PROGRESS"})).success?(r.success("업무가 재개되었습니다."),d()):r.error("상태 변경에 실패했습니다.")}catch{r.error("상태 변경에 실패했습니다.")}}async function $(s){try{(await _.completeItem(s.boardId,s.itemId)).success?(r.success("완료 처리되었습니다."),d()):r.error("완료 처리에 실패했습니다.")}catch{r.error("완료 처리에 실패했습니다.")}}async function z(s){if(await V.show({title:"업무 삭제",message:"이 업무를 삭제하시겠습니까?",confirmText:"삭제",confirmType:"danger"}))try{(await _.deleteItem(s.boardId,s.itemId)).success?(r.success("삭제되었습니다."),d()):r.error("삭제에 실패했습니다.")}catch{r.error("삭제에 실패했습니다.")}}function f(s){const e=new Date(s.updatedAt||s.createdAt);return Math.floor((new Date().getTime()-e.getTime())/(1e3*60*60*24))}function M(s){return{URGENT:"긴급",HIGH:"높음",NORMAL:"보통",LOW:"낮음"}[s]}function R(s){return{URGENT:"danger",HIGH:"warning",NORMAL:"primary",LOW:"default"}[s]}function S(s){return s?new Date(s).toLocaleDateString("ko-KR",{month:"2-digit",day:"2-digit"}):"-"}function j(s){g.value=s,d()}return L([x],()=>{g.value=0,d()}),O(()=>{d()}),(s,e)=>(l(),i("div",rt,[e[9]||(e[9]=U('<div class="flex items-center justify-between mb-4"><div><h2 class="text-xl font-semibold text-gray-900 flex items-center gap-2"> 보류 업무 <svg class="w-5 h-5 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></h2><p class="text-sm text-gray-500 mt-1">보류 상태인 업무를 관리합니다.</p></div></div>',1)),t("div",nt,[t("div",lt,[t("div",it,a(p.value.total),1),e[2]||(e[2]=t("div",{class:"text-sm text-gray-500"},"전체 보류",-1))]),t("div",dt,[t("div",ct,a(p.value.avgDays)+"일",1),e[3]||(e[3]=t("div",{class:"text-sm text-gray-500"},"평균 보류 기간",-1))]),t("div",pt,[t("div",ut,a(p.value.longPending),1),e[4]||(e[4]=t("div",{class:"text-sm text-gray-500"},"7일 이상 보류",-1))]),t("div",xt,[t("div",gt,a(p.value.urgentHigh),1),e[5]||(e[5]=t("div",{class:"text-sm text-gray-500"},"긴급/높음",-1))])]),t("div",mt,[t("div",ft,[t("div",ht,[e[6]||(e[6]=t("span",{class:"text-sm font-medium text-gray-700 whitespace-nowrap"},"보드:",-1)),y(u(tt),{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=o=>x.value=o),options:B.value,size:"sm",class:"w-40"},null,8,["modelValue","options"])]),t("div",vt,a(c.value.length)+"건 / 총 "+a(m.value)+"건 ",1)])]),t("div",yt,[b.value?(l(),i("div",_t,[y(u(et),{size:"lg"})])):c.value.length===0?(l(),F(u(ot),{key:1,title:"보류된 업무가 없습니다",description:"현재 보류 상태인 업무가 없습니다.",icon:"check-circle",class:"flex-1"})):(l(),i(C,{key:2},[t("div",bt,[t("table",wt,[e[8]||(e[8]=t("thead",{class:"sticky top-0 bg-gray-50 z-10"},[t("tr",{class:"border-b border-gray-200"},[t("th",{class:"px-4 h-10 text-left text-[13px] font-medium text-gray-600 whitespace-nowrap"}," 보류 기간 "),t("th",{class:"px-4 h-10 text-left text-[13px] font-medium text-gray-600 whitespace-nowrap min-w-[250px]"}," 작업 내용 "),t("th",{class:"px-4 h-10 text-left text-[13px] font-medium text-gray-600 whitespace-nowrap"}," 우선순위 "),t("th",{class:"px-4 h-10 text-left text-[13px] font-medium text-gray-600 whitespace-nowrap"}," 담당자 "),t("th",{class:"px-4 h-10 text-left text-[13px] font-medium text-gray-600 whitespace-nowrap"}," 보류일 "),t("th",{class:"px-4 h-10 text-center text-[13px] font-medium text-gray-600 whitespace-nowrap"}," 처리 ")])],-1)),t("tbody",kt,[(l(!0),i(C,null,W(c.value,o=>{var h;return l(),i("tr",{key:o.itemId,class:"group hover:bg-gray-50 transition-colors cursor-pointer",onClick:v=>I(o)},[t("td",Ct,[t("div",Nt,[t("span",{class:q(["inline-flex items-center justify-center min-w-[40px] px-2 py-1 text-[13px] font-bold rounded",[f(o)>=14?"bg-red-100 text-red-700":f(o)>=7?"bg-orange-100 text-orange-700":"bg-yellow-100 text-yellow-700"]])},a(f(o))+"일 ",3)])]),t("td",Pt,[t("div",Dt,[t("span",{class:"text-[13px] text-gray-900 truncate max-w-[300px]",title:o.title},a(o.title),9,Vt),t("button",{class:"flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity px-1.5 py-0.5 text-[11px] text-gray-500 hover:text-primary-600 hover:bg-primary-50 rounded",title:"상세 패널 열기",onClick:P(v=>I(o),["stop"])}," 열기 ",8,At),o.boardName?(l(),i("span",Bt,a(o.boardName),1)):N("",!0)])]),t("td",Ht,[y(u(st),{variant:R(o.priority),size:"sm"},{default:K(()=>[J(a(M(o.priority)),1)]),_:2},1032,["variant"])]),t("td",Tt,[t("div",$t,[t("div",zt,a(((h=o.assigneeName)==null?void 0:h.charAt(0))||"?"),1),t("span",null,a(o.assigneeName||"-"),1)])]),t("td",Mt,a(S(o.updatedAt||o.createdAt)),1),t("td",{class:"px-4 h-12 text-center",onClick:e[1]||(e[1]=P(()=>{},["stop"]))},[t("div",Rt,[t("button",{class:"px-2.5 py-1 text-[12px] font-medium text-white bg-blue-500 hover:bg-blue-600 rounded transition-colors",title:"재개",onClick:v=>T(o)}," 재개 ",8,St),t("button",{class:"px-2.5 py-1 text-[12px] font-medium text-white bg-green-500 hover:bg-green-600 rounded transition-colors",title:"완료",onClick:v=>$(o)}," 완료 ",8,jt),t("button",{class:"p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"삭제",onClick:v=>z(o)},[...e[7]||(e[7]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Et)])])],8,It)}),128))])])]),w.value>1?(l(),i("div",Gt,[y(u(at),{"current-page":g.value,"total-pages":w.value,"total-elements":m.value,onPageChange:j},null,8,["current-page","total-pages","total-elements"])])):N("",!0)],64))])]))}});export{ee as default};
