import{d as E,r,c as G,z as P,o as R,f as c,h as T,g as e,t as o,k as m,j as p,x as A,F as V,i as z,s as F,q as W,w as k,n as i}from"./index-D8qsMxsh.js";import{i as I}from"./item-CAonLf5Y.js";import{u as q}from"./board-BqBw7K7S.js";import{u as K}from"./useSlideOver-DM1nQhnY.js";import{u as J}from"./useToast-BaLNVjwd.js";import{_ as C}from"./Select.vue_vue_type_script_setup_true_lang-CpAO5_7Q.js";import"./MarkdownEditor.vue_vue_type_style_index_0_scoped_f90f4426_lang-Bc65I5vA.js";import{_ as Q}from"./Spinner.vue_vue_type_script_setup_true_lang-i4Z96JvV.js";import{_ as X}from"./EmptyState.vue_vue_type_script_setup_true_lang-DF03tBGG.js";import{_ as Y}from"./Pagination.vue_vue_type_script_setup_true_lang-D8QDOFFt.js";const Z={class:"h-full flex flex-col"},ee={class:"grid grid-cols-2 sm:grid-cols-4 gap-4 mb-4"},te={class:"bg-white rounded-lg border border-gray-200 p-4"},se={class:"text-2xl font-bold text-red-600"},ae={class:"bg-white rounded-lg border border-gray-200 p-4"},oe={class:"text-2xl font-bold text-red-500"},le={class:"bg-white rounded-lg border border-gray-200 p-4"},re={class:"text-2xl font-bold text-orange-500"},ne={class:"bg-white rounded-lg border border-gray-200 p-4"},ie={class:"text-2xl font-bold text-gray-700"},de={class:"bg-white rounded-lg border border-gray-200 p-4 mb-4"},ce={class:"flex flex-wrap items-center gap-4"},ue={class:"flex items-center gap-2"},pe={class:"flex items-center gap-2"},xe={class:"ml-auto text-sm text-gray-500"},ge={class:"flex-1 bg-white rounded-lg border border-gray-200 overflow-hidden flex flex-col"},me={key:0,class:"flex-1 flex items-center justify-center"},ve={class:"flex-1 overflow-auto"},fe={class:"w-full"},he={class:"divide-y divide-gray-100"},ye=["onClick"],be={class:"px-4 h-12"},_e={class:"flex items-center gap-1.5"},we={class:"px-4 h-12"},ke={class:"flex items-center gap-2"},Ie=["title"],Ce=["onClick"],De={key:0,class:"px-1.5 py-0.5 text-[11px] bg-gray-100 text-gray-500 rounded flex-shrink-0"},Ne={class:"px-4 h-12 text-[13px] text-red-600 font-medium whitespace-nowrap"},Ve={class:"px-4 h-12 text-[13px] text-gray-600 whitespace-nowrap"},ze={class:"flex items-center gap-2"},Oe={class:"w-6 h-6 rounded-full bg-primary-100 text-primary-600 flex items-center justify-center text-[11px] font-medium"},Be=["onClick"],He={key:0,class:"flex-shrink-0 border-t border-gray-200 px-4 py-3"},Ae=E({__name:"OverdueView",setup(Le){const D=q(),{openItemDetail:O}=K(),n=J(),_=r(!1),d=r([]),v=r(null),x=r("all"),f=r(0),B=r(20),h=r(0),w=r(0),g=r({total:0,urgent:0,high:0,avgDays:0}),H=G(()=>[{value:null,label:"전체 보드"},...D.activeBoards.map(a=>({value:a.boardId,label:a.boardName}))]),L=[{value:"all",label:"전체 우선순위"},{value:"URGENT",label:"긴급"},{value:"HIGH",label:"높음"},{value:"NORMAL",label:"보통"},{value:"LOW",label:"낮음"}];async function y(){_.value=!0;try{await D.fetchBoards();const a={boardId:v.value||void 0,priority:x.value!=="all"?x.value:void 0,page:f.value,size:B.value,sort:"dueDate,asc"},t=await I.getOverdueItems(a);t.success&&t.data?(d.value=t.data.content,h.value=t.data.totalElements,w.value=t.data.totalPages,M()):n.error("데이터를 불러오는데 실패했습니다.")}catch{n.error("데이터를 불러오는데 실패했습니다.")}finally{_.value=!1}}function M(){const a=d.value,t=a.map(s=>b(s));g.value={total:h.value,urgent:a.filter(s=>s.priority==="URGENT").length,high:a.filter(s=>s.priority==="HIGH").length,avgDays:t.length>0?Math.round(t.reduce((s,l)=>s+l,0)/t.length):0}}function N(a){O(a.itemId,a.boardId)}async function S(a){try{(await I.completeItem(a.boardId,a.itemId)).success?(n.success("완료 처리되었습니다."),y()):n.error("완료 처리에 실패했습니다.")}catch{n.error("완료 처리에 실패했습니다.")}}async function U(a,t){try{if((await I.updateItem(a.boardId,a.itemId,{priority:t})).success){n.success("우선순위가 변경되었습니다.");const l=d.value.findIndex(u=>u.itemId===a.itemId);l!==-1&&(d.value[l].priority=t)}else n.error("우선순위 변경에 실패했습니다.")}catch{n.error("우선순위 변경에 실패했습니다.")}}function b(a){if(!a.dueDate)return 0;const t=new Date(a.dueDate),s=new Date;s.setHours(0,0,0,0),t.setHours(0,0,0,0);const l=s.getTime()-t.getTime();return Math.max(0,Math.floor(l/(1e3*60*60*24)))}function $(a){return a?new Date(a).toLocaleDateString("ko-KR",{month:"2-digit",day:"2-digit"}):"-"}function j(a){f.value=a,y()}return P([v,x],()=>{f.value=0,y()}),R(()=>{y()}),(a,t)=>(i(),c("div",Z,[t[11]||(t[11]=T('<div class="flex items-center justify-between mb-4"><div><h2 class="text-xl font-semibold text-gray-900 flex items-center gap-2"> 지연 업무 <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg></h2><p class="text-sm text-gray-500 mt-1">마감일이 지난 업무를 관리합니다.</p></div></div>',1)),e("div",ee,[e("div",te,[e("div",se,o(g.value.total),1),t[4]||(t[4]=e("div",{class:"text-sm text-gray-500"},"전체 지연",-1))]),e("div",ae,[e("div",oe,o(g.value.urgent),1),t[5]||(t[5]=e("div",{class:"text-sm text-gray-500"},"긴급",-1))]),e("div",le,[e("div",re,o(g.value.high),1),t[6]||(t[6]=e("div",{class:"text-sm text-gray-500"},"높음",-1))]),e("div",ne,[e("div",ie,o(g.value.avgDays)+"일",1),t[7]||(t[7]=e("div",{class:"text-sm text-gray-500"},"평균 지연",-1))])]),e("div",de,[e("div",ce,[e("div",ue,[t[8]||(t[8]=e("span",{class:"text-sm font-medium text-gray-700 whitespace-nowrap"},"보드:",-1)),m(p(C),{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=s=>v.value=s),options:H.value,size:"sm",class:"w-40"},null,8,["modelValue","options"])]),e("div",pe,[t[9]||(t[9]=e("span",{class:"text-sm font-medium text-gray-700 whitespace-nowrap"},"우선순위:",-1)),m(p(C),{modelValue:x.value,"onUpdate:modelValue":t[1]||(t[1]=s=>x.value=s),options:L,size:"sm",class:"w-36"},null,8,["modelValue"])]),e("div",xe,o(d.value.length)+"건 / 총 "+o(h.value)+"건 ",1)])]),e("div",ge,[_.value?(i(),c("div",me,[m(p(Q),{size:"lg"})])):d.value.length===0?(i(),A(p(X),{key:1,title:"지연된 업무가 없습니다",description:"모든 업무가 마감일 내에 처리되고 있습니다.",icon:"check-circle",class:"flex-1"})):(i(),c(V,{key:2},[e("div",ve,[e("table",fe,[t[10]||(t[10]=e("thead",{class:"sticky top-0 bg-gray-50 z-10"},[e("tr",{class:"border-b border-gray-200"},[e("th",{class:"px-4 h-10 text-left text-[13px] font-medium text-gray-600 whitespace-nowrap"}," 지연 일수 "),e("th",{class:"px-4 h-10 text-left text-[13px] font-medium text-gray-600 whitespace-nowrap min-w-[250px]"}," 작업 내용 "),e("th",{class:"px-4 h-10 text-left text-[13px] font-medium text-gray-600 whitespace-nowrap"}," 마감일 "),e("th",{class:"px-4 h-10 text-left text-[13px] font-medium text-gray-600 whitespace-nowrap"}," 우선순위 "),e("th",{class:"px-4 h-10 text-left text-[13px] font-medium text-gray-600 whitespace-nowrap"}," 담당자 "),e("th",{class:"px-4 h-10 text-center text-[13px] font-medium text-gray-600 whitespace-nowrap"}," 처리 ")])],-1)),e("tbody",he,[(i(!0),c(V,null,F(d.value,s=>{var l;return i(),c("tr",{key:s.itemId,class:"group hover:bg-gray-50 transition-colors cursor-pointer",onClick:u=>N(s)},[e("td",be,[e("div",_e,[e("span",{class:W(["inline-flex items-center justify-center min-w-[40px] px-2 py-1 text-[13px] font-bold rounded",[b(s)>=7?"bg-red-100 text-red-700":b(s)>=3?"bg-orange-100 text-orange-700":"bg-yellow-100 text-yellow-700"]])},o(b(s))+"일 ",3)])]),e("td",we,[e("div",ke,[e("span",{class:"text-[13px] text-gray-900 truncate max-w-[300px]",title:s.title},o(s.title),9,Ie),e("button",{class:"flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity px-1.5 py-0.5 text-[11px] text-gray-500 hover:text-primary-600 hover:bg-primary-50 rounded",title:"상세 패널 열기",onClick:k(u=>N(s),["stop"])}," 열기 ",8,Ce),s.boardName?(i(),c("span",De,o(s.boardName),1)):z("",!0)])]),e("td",Ne,o($(s.dueDate)),1),e("td",{class:"px-4 h-12",onClick:t[2]||(t[2]=k(()=>{},["stop"]))},[m(p(C),{"model-value":s.priority,options:[{value:"URGENT",label:"긴급"},{value:"HIGH",label:"높음"},{value:"NORMAL",label:"보통"},{value:"LOW",label:"낮음"}],size:"sm",class:"w-24","onUpdate:modelValue":u=>U(s,u)},null,8,["model-value","onUpdate:modelValue"])]),e("td",Ve,[e("div",ze,[e("div",Oe,o(((l=s.assigneeName)==null?void 0:l.charAt(0))||"?"),1),e("span",null,o(s.assigneeName||"-"),1)])]),e("td",{class:"px-4 h-12 text-center",onClick:t[3]||(t[3]=k(()=>{},["stop"]))},[e("button",{class:"px-3 py-1.5 text-[12px] font-medium text-white bg-green-500 hover:bg-green-600 rounded transition-colors",onClick:u=>S(s)}," 완료 ",8,Be)])],8,ye)}),128))])])]),w.value>1?(i(),c("div",He,[m(p(Y),{"current-page":f.value,"total-pages":w.value,"total-elements":h.value,onPageChange:j},null,8,["current-page","total-pages","total-elements"])])):z("",!0)],64))])]))}});export{Ae as default};
