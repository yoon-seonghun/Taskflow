import{_ as U}from"./Input.vue_vue_type_script_setup_true_lang-DbFXPxNG.js";import{_ as E}from"./Select.vue_vue_type_script_setup_true_lang-CpAO5_7Q.js";import{u as j}from"./user-BWwGCR1b.js";import{d as $,u as P,D,r as h,c as T,z as G,o as F,f as c,g as e,k,i as N,p as I,t as y,n as u,F as L,s as H,q,m as Y}from"./index-D8qsMxsh.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as J}from"./Badge.vue_vue_type_script_setup_true_lang-BICiYF9q.js";import{t as S}from"./template-GTpC92te.js";const K={class:"template-form"},Q={class:"space-y-4"},W={class:"flex items-center gap-2 pt-2"},X=["disabled"],Z={key:0,class:"flex items-center justify-center gap-2"},ee={key:1},te=["disabled"],ae=$({__name:"TemplateForm",props:{template:{default:null},loading:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(i,{expose:g,emit:x}){const m=i,r=x,t=P(),b=D(),d=h(""),v=h(null),o=h("NOT_STARTED"),l=h([]),n=h(!1),a=[{value:"NOT_STARTED",label:"시작전",color:"#6B7280"},{value:"IN_PROGRESS",label:"진행중",color:"#3B82F6"},{value:"PENDING",label:"보류",color:"#F59E0B"}],f=T(()=>l.value.map(s=>({value:s.userId,label:s.userName}))),p=T(()=>!!m.template),C=T(()=>p.value?"변경":"등록"),B=T(()=>d.value.trim().length>0);async function R(){n.value=!0;try{const s=await j.getUsers({useYn:"Y",size:100});l.value=s.data.content}catch(s){console.error("Failed to load users:",s),b.showError("담당자 목록을 불러오는데 실패했습니다.")}finally{n.value=!1}}function V(){d.value="",v.value=t.currentUserId,o.value="NOT_STARTED"}function z(s){d.value=s.content,v.value=s.defaultAssigneeId??null,o.value=s.defaultItemStatus??"NOT_STARTED"}function M(){if(!(!B.value||m.loading))if(p.value){const s={content:d.value.trim(),defaultAssigneeId:v.value??void 0,defaultItemStatus:o.value};r("submit",s)}else{const s={content:d.value.trim(),defaultAssigneeId:v.value??void 0,defaultItemStatus:o.value};r("submit",s)}}function O(){V(),r("cancel")}return G(()=>m.template,s=>{s?z(s):V()},{immediate:!0}),F(()=>{R(),m.template||(v.value=t.currentUserId)}),g({resetForm:V}),(s,_)=>(u(),c("div",K,[e("div",Q,[k(U,{modelValue:d.value,"onUpdate:modelValue":_[0]||(_[0]=w=>d.value=w),label:"작업 내용",placeholder:"자주 사용하는 작업 내용을 입력하세요",required:!0,maxlength:500,disabled:i.loading},null,8,["modelValue","disabled"]),k(E,{modelValue:v.value,"onUpdate:modelValue":_[1]||(_[1]=w=>v.value=w),options:f.value,label:"기본 담당자",placeholder:"담당자 선택",searchable:!0,clearable:!0,disabled:i.loading||n.value},null,8,["modelValue","options","disabled"]),k(E,{modelValue:o.value,"onUpdate:modelValue":_[2]||(_[2]=w=>o.value=w),options:a,label:"기본 상태",placeholder:"상태 선택",disabled:i.loading},null,8,["modelValue","disabled"]),e("div",W,[e("button",{type:"button",class:"btn-primary flex-1",disabled:!B.value||i.loading,onClick:M},[i.loading?(u(),c("span",Z,[..._[3]||(_[3]=[e("svg",{class:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})],-1),I(" 처리중... ",-1)])])):(u(),c("span",ee,y(C.value),1))],8,X),p.value?(u(),c("button",{key:0,type:"button",class:"btn-secondary",disabled:i.loading,onClick:O}," 취소 ",8,te)):N("",!0)])])]))}}),le=A(ae,[["__scopeId","data-v-5e2eec5b"]]),se={class:"template-list"},oe={key:0,class:"py-8 text-center"},ne={key:1,class:"py-8 text-center"},ie={key:2,class:"divide-y divide-gray-100"},re=["onClick"],de={class:"flex items-start gap-3"},ce={class:"flex-1 min-w-0"},ue={class:"text-sm font-medium text-gray-900 truncate"},me={class:"mt-1 flex flex-wrap items-center gap-2 text-xs text-gray-500"},ve={key:0,class:"flex items-center gap-1"},fe={class:"flex items-center gap-1"},pe=["disabled","onClick"],ge=$({__name:"TemplateList",props:{templates:{},selectedId:{default:null},loading:{type:Boolean,default:!1}},emits:["select","delete"],setup(i,{emit:g}){const x=i,m=g,r={NOT_STARTED:{label:"시작전",variant:"default"},IN_PROGRESS:{label:"진행중",variant:"info"},PENDING:{label:"보류",variant:"warning"}};function t(o){return r[o]||r.NOT_STARTED}function b(o){x.loading||m("select",o)}function d(o,l){o.stopPropagation(),!x.loading&&m("delete",l)}function v(o){return x.selectedId===o.templateId}return(o,l)=>(u(),c("div",se,[i.loading&&i.templates.length===0?(u(),c("div",oe,[...l[0]||(l[0]=[e("svg",{class:"animate-spin h-6 w-6 mx-auto text-gray-400",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})],-1),e("p",{class:"mt-2 text-sm text-gray-500"},"템플릿을 불러오는 중...",-1)])])):i.templates.length===0?(u(),c("div",ne,[...l[1]||(l[1]=[e("svg",{class:"mx-auto h-10 w-10 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),e("p",{class:"mt-2 text-sm text-gray-500"},"등록된 작업 템플릿이 없습니다.",-1),e("p",{class:"text-xs text-gray-400"},"위에서 새 템플릿을 등록해보세요.",-1)])])):(u(),c("div",ie,[(u(!0),c(L,null,H(i.templates,n=>(u(),c("div",{key:n.templateId,class:q(["template-item",{selected:v(n)}]),onClick:a=>b(n)},[e("div",de,[e("div",ce,[e("div",ue,y(n.content),1),e("div",me,[n.defaultAssigneeName?(u(),c("span",ve,[l[2]||(l[2]=e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),I(" "+y(n.defaultAssigneeName),1)])):N("",!0),k(J,{variant:t(n.defaultItemStatus).variant,size:"sm"},{default:Y(()=>[I(y(t(n.defaultItemStatus).label),1)]),_:2},1032,["variant"]),e("span",fe,[l[3]||(l[3]=e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})],-1)),I(" 사용 "+y(n.useCount)+"회 ",1)])])]),e("button",{type:"button",class:"delete-btn",title:"삭제",disabled:i.loading,onClick:a=>d(a,n)},[...l[4]||(l[4]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,pe)])],10,re))),128))]))]))}}),he=A(ge,[["__scopeId","data-v-803588e5"]]),xe={class:"templates-view"},_e={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},ye={class:"lg:col-span-1"},be={class:"sticky top-4"},ke={class:"text-sm font-medium text-gray-700 mb-3"},we={class:"lg:col-span-2"},Te={class:"flex items-center justify-between mb-3"},Se={class:"text-sm font-medium text-gray-700"},Ie=$({__name:"TemplatesView",setup(i){const g=D(),x=h([]),m=h(!1),r=h(!1),t=h(null),b=h(null);async function d(){m.value=!0;try{const a=await S.getTemplates();x.value=a.data}catch(a){console.error("Failed to load templates:",a)}finally{m.value=!1}}async function v(a){var f;r.value=!0;try{t.value?(await S.updateTemplate(t.value.templateId,a),g.showSuccess("템플릿이 수정되었습니다."),t.value=null):(await S.createTemplate(a),g.showSuccess("템플릿이 등록되었습니다.")),await d(),(f=b.value)==null||f.resetForm()}catch(p){console.error("Failed to save template:",p),g.showError("템플릿 저장에 실패했습니다.")}finally{r.value=!1}}function o(a){var f;((f=t.value)==null?void 0:f.templateId)===a.templateId?t.value=null:t.value=a}function l(){t.value=null}async function n(a){var p;if(await g.confirm({title:"템플릿 삭제",message:`'${a.content}' 템플릿을 삭제하시겠습니까?`,confirmText:"삭제",cancelText:"취소",confirmType:"danger"})){r.value=!0;try{await S.deleteTemplate(a.templateId),((p=t.value)==null?void 0:p.templateId)===a.templateId&&(t.value=null),await d(),g.showSuccess("템플릿이 삭제되었습니다.")}catch(C){console.error("Failed to delete template:",C),g.showError("템플릿 삭제에 실패했습니다.")}finally{r.value=!1}}}return F(()=>{d()}),(a,f)=>{var p;return u(),c("div",xe,[f[0]||(f[0]=e("div",{class:"mb-6"},[e("h1",{class:"text-xl font-semibold text-gray-900"},"작업 등록 메뉴"),e("p",{class:"mt-1 text-sm text-gray-500"}," 자주 사용하는 작업을 템플릿으로 등록하여 업무 등록 시 빠르게 입력할 수 있습니다. ")],-1)),e("div",_e,[e("div",ye,[e("div",be,[e("h2",ke,y(t.value?"템플릿 수정":"새 템플릿 등록"),1),k(le,{ref_key:"formRef",ref:b,template:t.value,loading:r.value,onSubmit:v,onCancel:l},null,8,["template","loading"])])]),e("div",we,[e("div",Te,[e("h2",Se," 등록된 템플릿 ("+y(x.value.length)+"건) ",1),t.value?(u(),c("button",{key:0,type:"button",class:"text-sm text-gray-500 hover:text-gray-700",onClick:l}," 선택 해제 ")):N("",!0)]),k(he,{templates:x.value,"selected-id":(p=t.value)==null?void 0:p.templateId,loading:m.value||r.value,onSelect:o,onDelete:n},null,8,["templates","selected-id","loading"])])])])}}}),De=A(Ie,[["__scopeId","data-v-7c12ca20"]]);export{De as default};
