import{G as C,r as c,c as D}from"./index-D8qsMxsh.js";import{d as o}from"./department-Dz_c4A8s.js";const K=C("department",()=>{const u=c([]),m=c([]),s=c(null),i=c([]),f=c(!1),r=c(null),l=c(new Set),x=D(()=>y(u.value)),A=D(()=>m.value.filter(e=>e.useYn==="Y")),F=D(()=>{var e;return((e=s.value)==null?void 0:e.departmentId)||null});function y(e){return e.filter(t=>t.useYn==="Y").map(t=>({...t,children:t.children?y(t.children):void 0}))}function h(e,t){for(const a of e){if(a.departmentId===t)return a;if(a.children){const n=h(a.children,t);if(n)return n}}return null}function w(e,t,a){for(let n=0;n<e.length;n++){if(e[n].departmentId===t)return e[n]={...e[n],...a},!0;if(e[n].children&&w(e[n].children,t,a))return!0}return!1}function g(e,t){return e.filter(a=>a.departmentId===t?!1:(a.children&&(a.children=g(a.children,t)),!0))}async function p(e){f.value=!0,r.value=null;try{const t=await o.getDepartments(e);return t.success&&t.data?(u.value=t.data,N(),!0):(r.value=t.message||"부서 목록을 불러오는데 실패했습니다.",!1)}catch{return r.value="부서 목록을 불러오는데 실패했습니다.",!1}finally{f.value=!1}}async function v(e){try{const t=await o.getDepartmentsFlat(e);return t.success&&t.data?(m.value=t.data,!0):!1}catch{return!1}}async function S(e){f.value=!0,r.value=null;try{const t=await o.createDepartment(e);return t.success&&t.data?(await p(),await v(),t.data):(r.value=t.message||"부서 생성에 실패했습니다.",null)}catch{return r.value="부서 생성에 실패했습니다.",null}finally{f.value=!1}}async function Y(e,t){var a;r.value=null;try{const n=h(u.value,e),z=n==null?void 0:n.parentId,d=await o.updateDepartment(e,t);return d.success&&d.data?(t.parentId!==z?await p():w(u.value,e,d.data),((a=s.value)==null?void 0:a.departmentId)===e&&(s.value=d.data),await v(),!0):(r.value=d.message||"부서 수정에 실패했습니다.",!1)}catch{return r.value="부서 수정에 실패했습니다.",!1}}async function T(e){var t;r.value=null;try{const a=await o.deleteDepartment(e);return a.success?(u.value=g(u.value,e),((t=s.value)==null?void 0:t.departmentId)===e&&(s.value=null,i.value=[]),await v(),!0):(r.value=a.message||"부서 삭제에 실패했습니다.",!1)}catch{return r.value="부서 삭제에 실패했습니다.",!1}}async function U(e,t){try{return(await o.updateDepartmentOrder(e,t)).success?(await p(),!0):!1}catch{return!1}}async function I(e){try{const t=await o.getDepartmentUsers(e);return t.success&&t.data?(i.value=t.data,!0):!1}catch{return!1}}function E(e){l.value.has(e)?l.value.delete(e):l.value.add(e)}function O(e){l.value.add(e)}function B(e){l.value.delete(e)}function N(){const e=t=>{var a;for(const n of t)l.value.add(n.departmentId),(a=n.children)!=null&&a.length&&e(n.children)};e(u.value)}function G(){l.value.clear()}function P(e){return l.value.has(e)}function b(e){s.value=e,e?I(e.departmentId):i.value=[]}function j(e){return h(u.value,e)}function k(){s.value=null,i.value=[]}function q(){r.value=null}return{departments:u,flatDepartments:m,selectedDepartment:s,departmentUsers:i,loading:f,error:r,expandedNodes:l,activeDepartments:x,activeFlatDepartments:A,selectedDepartmentId:F,fetchDepartments:p,fetchFlatDepartments:v,createDepartment:S,updateDepartment:Y,deleteDepartment:T,updateDepartmentOrder:U,fetchDepartmentUsers:I,toggleNode:E,expandNode:O,collapseNode:B,expandAllNodes:N,collapseAllNodes:G,isExpanded:P,selectDepartment:b,getDepartmentById:j,clearSelection:k,clearError:q}});export{K as u};
