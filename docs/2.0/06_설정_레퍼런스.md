# TaskFlow 2.0 설정 레퍼런스

> 모든 설정 항목을 카테고리별로 정리한 문서입니다.

## 목차
1. [환경 변수 (.env)](#1-환경-변수-env)
2. [데이터베이스 설정](#2-데이터베이스-설정)
3. [인증/보안 설정](#3-인증보안-설정)
4. [파일 스토리지 설정](#4-파일-스토리지-설정)
5. [서버 포트 설정](#5-서버-포트-설정)
6. [CORS 설정](#6-cors-설정)
7. [로깅 설정](#7-로깅-설정)
8. [커넥션 풀 설정](#8-커넥션-풀-설정)
9. [Nginx 설정](#9-nginx-설정)
10. [프로파일별 설정](#10-프로파일별-설정)

---

## 1. 환경 변수 (.env)

### 1.1 필수 설정 (반드시 변경 필요)

| 변수명 | 설명 | 기본값 | 예시 |
|--------|------|--------|------|
| `JWT_SECRET` | JWT 서명 시크릿 키 (Base64, 256비트 이상) | - | `openssl rand -base64 32` 로 생성 |
| `MYSQL_ROOT_PASSWORD` | MySQL root 비밀번호 | `root` | 운영 환경에서 변경 필수 |
| `MYSQL_PASSWORD` | 애플리케이션 DB 비밀번호 | `taskflow123` | 운영 환경에서 변경 필수 |

### 1.2 데이터베이스 설정

| 변수명 | 설명 | 기본값 |
|--------|------|--------|
| `MYSQL_ROOT_PASSWORD` | root 계정 비밀번호 | `root` |
| `MYSQL_DATABASE` | 데이터베이스명 | `taskflow` |
| `MYSQL_USER` | 애플리케이션 DB 사용자 | `taskflow` |
| `MYSQL_PASSWORD` | 애플리케이션 DB 비밀번호 | `taskflow123` |

### 1.3 서버 포트 설정

| 변수명 | 설명 | 기본값 |
|--------|------|--------|
| `MYSQL_PORT` | MySQL 외부 포트 | `3306` |
| `BACKEND_PORT` | 백엔드 API 포트 | `8080` |
| `FRONTEND_PORT` | 프론트엔드 포트 | `3000` |

### 1.4 인증/보안 설정

| 변수명 | 설명 | 기본값 |
|--------|------|--------|
| `JWT_SECRET` | JWT 시크릿 키 (Base64) | 필수 입력 |
| `COOKIE_SECURE` | 쿠키 Secure 플래그 (HTTPS 시 `true`) | `false` |

### 1.5 CORS 설정

| 변수명 | 설명 | 기본값 |
|--------|------|--------|
| `CORS_ALLOWED_ORIGINS` | 허용 Origin (쉼표 구분) | `http://localhost:3000` |

### 1.6 파일 스토리지 설정

| 변수명 | 설명 | 기본값 |
|--------|------|--------|
| `FILE_STORAGE_TYPE` | 스토리지 타입 | `LOCAL` |
| `FILE_MAX_SIZE` | 최대 파일 크기 | `10MB` |
| `FILE_LOCAL_PATH` | 로컬 저장 경로 | `/app/uploads` |

### 1.7 SFTP 스토리지 설정 (FILE_STORAGE_TYPE=SFTP 시)

| 변수명 | 설명 | 기본값 | 필수 |
|--------|------|--------|------|
| `SFTP_HOST` | SFTP 서버 주소 | - | O |
| `SFTP_PORT` | SFTP 포트 | `22` | |
| `SFTP_USERNAME` | SFTP 사용자명 | - | O |
| `SFTP_PASSWORD` | SFTP 비밀번호 | - | 비밀번호 인증 시 |
| `SFTP_PRIVATE_KEY_PATH` | SSH 개인키 경로 | - | 키 인증 시 |
| `SFTP_PRIVATE_KEY_PASSPHRASE` | 개인키 패스프레이즈 | - | |
| `SFTP_BASE_PATH` | 원격 저장 경로 | `/data/uploads` | |
| `SFTP_CONNECTION_TIMEOUT` | 연결 타임아웃 (ms) | `30000` | |
| `SFTP_CHANNEL_TIMEOUT` | 채널 타임아웃 (ms) | `60000` | |
| `SFTP_STRICT_HOST_KEY_CHECKING` | 호스트 키 검증 | `false` | |
| `SFTP_KNOWN_HOSTS_PATH` | known_hosts 파일 경로 | - | |
| `SFTP_POOL_SIZE` | 연결 풀 크기 | `5` | |
| `SFTP_KEEP_ALIVE_INTERVAL` | Keep-alive 간격 (ms) | `30000` | |

### 1.8 기타 설정

| 변수명 | 설명 | 기본값 |
|--------|------|--------|
| `TZ` | 타임존 | `Asia/Seoul` |

---

## 2. 데이터베이스 설정

### 2.1 MySQL 기본 설정 (docker-compose.yml)

```yaml
mysql:
  image: mysql:8.0
  command:
    - --character-set-server=utf8mb4
    - --collation-server=utf8mb4_unicode_ci
```

### 2.2 HikariCP 커넥션 풀 (application.yml)

| 설정 | 설명 | Local | Docker | Production |
|------|------|-------|--------|------------|
| `maximum-pool-size` | 최대 커넥션 수 | 10 | 20 | 30 |
| `minimum-idle` | 최소 유휴 커넥션 | 5 | 10 | 10 |
| `idle-timeout` | 유휴 타임아웃 (ms) | 30000 | 30000 | 30000 |
| `connection-timeout` | 연결 타임아웃 (ms) | 20000 | 20000 | 20000 |

### 2.3 Production DB 환경변수

| 변수명 | 설명 |
|--------|------|
| `DB_URL` | JDBC 연결 URL |
| `DB_USERNAME` | DB 사용자명 |
| `DB_PASSWORD` | DB 비밀번호 |

**예시:**
```bash
DB_URL=jdbc:mysql://db.example.com:3306/taskflow?useSSL=true&serverTimezone=Asia/Seoul
DB_USERNAME=taskflow_prod
DB_PASSWORD=secure_password_here
```

---

## 3. 인증/보안 설정

### 3.1 JWT 설정 (application.yml)

| 설정 | 설명 | 값 |
|------|------|-----|
| `jwt.secret` | 시크릿 키 (Base64) | 환경변수 `JWT_SECRET` |
| `jwt.access-token-validity` | Access Token 유효시간 | `1800000` (30분) |
| `jwt.refresh-token-validity` | Refresh Token 유효시간 | `604800000` (7일) |

### 3.2 JWT 시크릿 키 생성 방법

```bash
# Linux/Mac
openssl rand -base64 32

# 또는 온라인 도구 사용
# 결과 예시: K7gNU3sdo+OL0wNhqoVWhr3g6s1xYv72ol/pe/Unols=
```

### 3.3 Cookie 설정

| 설정 | 설명 | HTTP | HTTPS |
|------|------|------|-------|
| `cookie.secure` | Secure 플래그 | `false` | `true` |

### 3.4 비밀번호 정책 (하드코딩)

| 항목 | 값 |
|------|-----|
| 최소 길이 | 8자 |
| 대문자 필수 | 1개 이상 |
| 소문자 필수 | 1개 이상 |
| 숫자 필수 | 1개 이상 |
| 특수문자 필수 | 1개 이상 (!@#$%^&*) |
| 암호화 방식 | BCrypt |

---

## 4. 파일 스토리지 설정

### 4.1 스토리지 타입

| 타입 | 설명 | 상태 |
|------|------|------|
| `LOCAL` | 로컬 디스크/Docker 볼륨 | 구현 완료 |
| `SFTP` | SFTP 외부 스토리지 | 구현 완료 |
| `NAS` | 네트워크 스토리지 | 미구현 |
| `S3` | AWS S3/MinIO | 미구현 |

### 4.2 파일 업로드 제한 (application.yml)

| 설정 | 설명 | 기본값 |
|------|------|--------|
| `spring.servlet.multipart.max-file-size` | 개별 파일 최대 크기 | `10MB` |
| `spring.servlet.multipart.max-request-size` | 요청 전체 최대 크기 | `50MB` |
| `file.storage.max-file-size` | 스토리지 레벨 제한 | `10MB` |

### 4.3 허용 파일 확장자

```yaml
file:
  storage:
    allowed-extensions:
      # 이미지
      - jpg
      - jpeg
      - png
      - gif
      - webp
      - svg
      # 문서
      - pdf
      - doc
      - docx
      - xls
      - xlsx
      - ppt
      - pptx
      - txt
      # 압축
      - zip
```

### 4.4 LOCAL 스토리지 설정

| 환경 | 저장 경로 |
|------|----------|
| Local (개발) | `./uploads` |
| Docker | `/app/uploads` |
| Production | `${FILE_LOCAL_PATH:/app/uploads}` |

### 4.5 SFTP 스토리지 설정 상세

```yaml
file:
  storage:
    type: SFTP
    sftp:
      # 연결 정보
      host: ${SFTP_HOST}
      port: ${SFTP_PORT:22}
      username: ${SFTP_USERNAME}

      # 인증 (둘 중 하나 선택)
      password: ${SFTP_PASSWORD}                    # 비밀번호 인증
      private-key-path: ${SFTP_PRIVATE_KEY_PATH}    # SSH 키 인증
      private-key-passphrase: ${SFTP_PRIVATE_KEY_PASSPHRASE}

      # 저장 경로
      base-path: ${SFTP_BASE_PATH:/data/uploads}

      # 타임아웃
      connection-timeout: ${SFTP_CONNECTION_TIMEOUT:30000}  # 30초
      channel-timeout: ${SFTP_CHANNEL_TIMEOUT:60000}        # 60초

      # 보안
      strict-host-key-checking: ${SFTP_STRICT_HOST_KEY_CHECKING:false}
      known-hosts-path: ${SFTP_KNOWN_HOSTS_PATH}

      # 성능
      pool-size: ${SFTP_POOL_SIZE:5}
      keep-alive-interval: ${SFTP_KEEP_ALIVE_INTERVAL:30000}
```

---

## 5. 서버 포트 설정

### 5.1 기본 포트 구성

| 서비스 | 컨테이너 내부 | 외부 노출 | 환경변수 |
|--------|-------------|----------|----------|
| MySQL | 3306 | `${MYSQL_PORT:-3306}` | `MYSQL_PORT` |
| Backend | 8080 | `${BACKEND_PORT:-8080}` | `BACKEND_PORT` |
| Frontend | 80 | `${FRONTEND_PORT:-3000}` | `FRONTEND_PORT` |

### 5.2 개발 환경 포트 (vite.config.ts)

```typescript
server: {
  port: 3000,
  proxy: {
    '/api': {
      target: 'http://localhost:8080',
      changeOrigin: true
    }
  }
}
```

---

## 6. CORS 설정

### 6.1 허용 Origin 설정 (application.yml)

| 환경 | 설정값 |
|------|--------|
| Local | `http://localhost:3000,http://localhost:5173` |
| Docker | `${CORS_ALLOWED_ORIGINS:http://localhost:3000}` |
| Production | `${CORS_ALLOWED_ORIGINS}` |

### 6.2 CORS 관련 설정

| 설정 | 설명 | 기본값 |
|------|------|--------|
| `cors.allowed-origins` | 허용 Origin 목록 | - |
| `cors.max-age` | Preflight 캐시 시간 (초) | `3600` |

### 6.3 포트 변경 시 주의사항

```bash
# FRONTEND_PORT 변경 시 CORS도 함께 변경 필요!
FRONTEND_PORT=4000
CORS_ALLOWED_ORIGINS=http://localhost:4000
```

---

## 7. 로깅 설정

### 7.1 로그 레벨 (application.yml)

| 환경 | root | com.taskflow | com.taskflow.mapper |
|------|------|--------------|---------------------|
| Local | INFO | DEBUG | DEBUG |
| Docker | INFO | INFO | INFO |
| Production | WARN | INFO | - |

### 7.2 로그 패턴

```
[%d{yyyy-MM-dd HH:mm:ss}] [%level] [%thread] %logger{36} - %msg%n
```

**출력 예시:**
```
[2024-12-24 10:30:45] [INFO] [main] c.t.service.ItemService - Item created: id=123
```

### 7.3 SQL 로깅 활성화 (개발 환경)

```yaml
logging:
  level:
    com.taskflow.mapper: DEBUG
```

---

## 8. 커넥션 풀 설정

### 8.1 HikariCP (데이터베이스)

| 설정 | Local | Docker | Production | 설명 |
|------|-------|--------|------------|------|
| `maximum-pool-size` | 10 | 20 | 30 | 최대 커넥션 |
| `minimum-idle` | 5 | 10 | 10 | 최소 유휴 |
| `idle-timeout` | 30000 | 30000 | 30000 | 유휴 타임아웃 |
| `connection-timeout` | 20000 | 20000 | 20000 | 연결 타임아웃 |

### 8.2 SFTP 연결 풀

| 설정 | 기본값 | 설명 |
|------|--------|------|
| `sftp.pool-size` | 5 | 최대 세션 수 |
| `sftp.keep-alive-interval` | 30000 | Keep-alive 간격 (ms) |
| `sftp.connection-timeout` | 30000 | 연결 타임아웃 (ms) |
| `sftp.channel-timeout` | 60000 | 채널 타임아웃 (ms) |

---

## 9. Nginx 설정

### 9.1 기본 설정 (nginx.conf)

```nginx
server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;
```

### 9.2 Vue Router SPA 지원

```nginx
location / {
    try_files $uri $uri/ /index.html;
}
```

### 9.3 API 프록시

```nginx
location /api {
    proxy_pass http://backend:8080;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
```

### 9.4 SSE 프록시 (실시간 동기화)

```nginx
location /api/sse {
    proxy_pass http://backend:8080;
    proxy_set_header Host $host;
    proxy_set_header Connection '';
    proxy_http_version 1.1;
    chunked_transfer_encoding off;
    proxy_buffering off;
    proxy_cache off;
}
```

### 9.5 Gzip 압축

```nginx
gzip on;
gzip_types text/plain text/css application/json application/javascript text/xml application/xml;
```

---

## 10. 프로파일별 설정

### 10.1 프로파일 선택

| 프로파일 | 환경 | 활성화 방법 |
|----------|------|------------|
| `local` | 로컬 개발 | 기본값 |
| `docker` | Docker 환경 | `SPRING_PROFILES_ACTIVE=docker` |
| `prod` | 운영 환경 | `SPRING_PROFILES_ACTIVE=prod` |

### 10.2 프로파일별 주요 차이점

| 설정 | Local | Docker | Production |
|------|-------|--------|------------|
| DB Host | `localhost` | `mysql` | 환경변수 |
| 로그 레벨 | DEBUG | INFO | INFO/WARN |
| Cookie Secure | false | 환경변수 | true |
| CORS | 하드코딩 | 환경변수 | 환경변수 |
| 파일 경로 | `./uploads` | `/app/uploads` | 환경변수 |

---

## 부록: 전체 .env 파일 템플릿

```bash
# ============================================
# TaskFlow Docker Environment Configuration
# ============================================

# ==================== 필수 설정 ====================

# JWT 시크릿 (반드시 변경!)
# 생성: openssl rand -base64 32
JWT_SECRET=your-base64-encoded-secret-key-at-least-256-bits-long

# MySQL 데이터베이스 (운영 환경에서 변경!)
MYSQL_ROOT_PASSWORD=root
MYSQL_DATABASE=taskflow
MYSQL_USER=taskflow
MYSQL_PASSWORD=taskflow123

# ==================== 포트 설정 ====================

MYSQL_PORT=3306
BACKEND_PORT=8080
FRONTEND_PORT=3000

# ==================== 보안 설정 ====================

# CORS (FRONTEND_PORT 변경 시 함께 변경)
CORS_ALLOWED_ORIGINS=http://localhost:3000

# Cookie (HTTPS 사용 시 true)
COOKIE_SECURE=false

# ==================== 파일 스토리지 ====================

# 타입: LOCAL, SFTP
FILE_STORAGE_TYPE=LOCAL

# 파일 크기 제한
FILE_MAX_SIZE=10MB

# LOCAL 설정
FILE_LOCAL_PATH=/app/uploads

# SFTP 설정 (FILE_STORAGE_TYPE=SFTP 시 활성화)
# SFTP_HOST=sftp.example.com
# SFTP_PORT=22
# SFTP_USERNAME=sftpuser
# SFTP_PASSWORD=sftppassword
# SFTP_PRIVATE_KEY_PATH=/path/to/private/key
# SFTP_PRIVATE_KEY_PASSPHRASE=
# SFTP_BASE_PATH=/data/uploads
# SFTP_CONNECTION_TIMEOUT=30000
# SFTP_CHANNEL_TIMEOUT=60000
# SFTP_STRICT_HOST_KEY_CHECKING=false
# SFTP_POOL_SIZE=5

# ==================== 기타 ====================

TZ=Asia/Seoul
```

---

## 부록: 설정 값 조정 가이드

### 동시 사용자 수에 따른 권장 설정

| 동시 사용자 | DB Pool Size | SFTP Pool Size | 메모리 |
|------------|--------------|----------------|--------|
| ~50명 | 10 | 3 | 512MB |
| ~200명 | 20 | 5 | 1GB |
| ~500명 | 30 | 10 | 2GB |
| 500명+ | 50+ | 15+ | 4GB+ |

### 파일 업로드 용량 조정

```yaml
# application.yml
spring.servlet.multipart:
  max-file-size: 50MB        # 개별 파일 최대
  max-request-size: 100MB    # 요청 전체 최대

file:
  storage:
    max-file-size: 50MB      # 스토리지 레벨 제한
```

```bash
# .env
FILE_MAX_SIZE=50MB
```

---

**문서 버전**: 2.0.0
**최종 수정일**: 2024년 12월
