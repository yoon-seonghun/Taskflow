# 보드 관리 및 공유 기능 개발 계획서

> 작성일: 2024-12-21
> 버전: 1.0

---

## 1. 개요

### 1.1 목적
- 보드 생성/수정/삭제 관리 기능 구현
- 보드 및 업무 단위 공유 기능 구현
- 권한 기반 접근 제어 시스템 구축
- 통합 감사 로그를 통한 이력 관리

### 1.2 범위
| 구분 | 내용 |
|------|------|
| 보드 관리 | 생성, 수정, 삭제(논리), 목록 조회 |
| 업무 이관 | 보드 삭제 시 비종료 업무 이관 |
| 보드 공유 | 사용자별 권한 지정 공유 |
| 업무 공유 | 개별 업무 단위 공유 |
| 이력 관리 | 모든 변경사항 감사 로그 기록 |

---

## 2. 기능 요구사항

### 2.1 보드 관리

#### 2.1.1 보드 목록
- 내가 소유한 보드 표시
- 공유받은 보드 표시 (구분 표시)
- 정렬 순서 변경 (드래그 앤 드롭)

#### 2.1.2 보드 생성
| 필드 | 타입 | 필수 | 설명 |
|------|------|------|------|
| 보드명 | TEXT | O | 최대 200자 |
| 설명 | TEXT | - | 최대 500자 |
| 색상 | COLOR | - | HEX 코드 (#RRGGBB) |
| 기본 뷰타입 | SELECT | - | TABLE/KANBAN/LIST |

#### 2.1.3 보드 수정
- 보드 소유자만 수정 가능
- FULL 권한 공유자도 수정 가능

#### 2.1.4 보드 삭제
```
삭제 프로세스:
1. 삭제 요청
2. 비종료 업무 존재 여부 확인
   ├── 없음 → 3단계로
   └── 있음 → 업무 이관 화면 표시
       ├── 이관 대상자 선택
       ├── 이관 사유 입력 (선택)
       └── 이관 실행
3. 보드 논리 삭제 (USE_YN='N')
4. 감사 로그 기록
```

### 2.2 업무 이관

#### 2.2.1 이관 프로세스
```
1. 이관 대상자 선택
2. 이관받는 사용자에게 "이관 보드" 자동 생성
   - 보드명: "[이관] {원본보드명} - {날짜}"
3. 비종료 업무를 이관 보드로 이동
4. 원본 업무에 이관 정보 기록
   - TRANSFERRED_FROM: 원본 보드 ID
   - TRANSFERRED_AT: 이관 일시
5. 감사 로그 기록
```

#### 2.2.2 이관 대상 업무
- 상태가 '완료' 또는 '삭제'가 아닌 모든 업무

### 2.3 보드 공유

#### 2.3.1 권한 체계
| 권한 | 조회 | 수정 | 삭제 | 공유 관리 |
|------|------|------|------|----------|
| VIEW | O | X | X | X |
| EDIT | O | O | X | X |
| FULL | O | O | O | X |
| OWNER | O | O | O | O |

#### 2.3.2 공유 관리
- 보드 소유자만 공유 사용자 추가/제거 가능
- 공유 시 권한 지정 필수
- 공유 변경 시 감사 로그 기록

### 2.4 업무 공유

#### 2.4.1 공유 방식
- 보드 접근 권한 없이 특정 업무만 공유
- 업무 소유자 또는 FULL 권한자가 공유 가능

#### 2.4.2 권한 체계
| 권한 | 조회 | 수정 | 삭제 |
|------|------|------|------|
| VIEW | O | X | X |
| EDIT | O | O | X |
| FULL | O | O | O |

### 2.5 이력 관리

#### 2.5.1 기록 대상
| 대상 | 작업 유형 |
|------|----------|
| 보드 | CREATE, UPDATE, DELETE |
| 업무 | TRANSFER |
| 보드 공유 | SHARE, UNSHARE, UPDATE (권한 변경) |
| 업무 공유 | SHARE, UNSHARE, UPDATE (권한 변경) |

#### 2.5.2 감사 로그 데이터
- 대상 유형/ID
- 작업 유형
- 수행자
- 변경 전/후 데이터 (JSON)
- 관련 사용자 (이관/공유 대상)
- 작업 일시

---

## 3. 데이터베이스 설계

### 3.1 신규 테이블

#### TB_ITEM_SHARE (업무 공유)
| 컬럼 | 타입 | 필수 | 설명 |
|------|------|------|------|
| ITEM_SHARE_ID | BIGINT | PK | 업무 공유 ID |
| ITEM_ID | BIGINT | FK | 업무 ID |
| USER_ID | BIGINT | FK | 공유받는 사용자 ID |
| PERMISSION | VARCHAR(20) | O | VIEW/EDIT/FULL |
| CREATED_AT | DATETIME | O | 생성일시 |
| CREATED_BY | BIGINT | O | 생성자 |
| UPDATED_AT | DATETIME | - | 수정일시 |
| UPDATED_BY | BIGINT | - | 수정자 |

#### TB_AUDIT_LOG (통합 감사 로그)
| 컬럼 | 타입 | 필수 | 설명 |
|------|------|------|------|
| LOG_ID | BIGINT | PK | 로그 ID |
| TARGET_TYPE | VARCHAR(20) | O | BOARD/ITEM/BOARD_SHARE/ITEM_SHARE |
| TARGET_ID | BIGINT | O | 대상 ID |
| ACTION | VARCHAR(20) | O | CREATE/UPDATE/DELETE/TRANSFER/SHARE/UNSHARE |
| ACTOR_ID | BIGINT | FK | 수행자 ID |
| DESCRIPTION | VARCHAR(500) | - | 변경 내용 설명 |
| BEFORE_DATA | JSON | - | 변경 전 데이터 |
| AFTER_DATA | JSON | - | 변경 후 데이터 |
| RELATED_USER_ID | BIGINT | - | 관련 사용자 ID |
| CREATED_AT | DATETIME | O | 생성일시 |

### 3.2 기존 테이블 수정

#### TB_BOARD_SHARE
- PERMISSION 컬럼: MEMBER/VIEWER → VIEW/EDIT/FULL

#### TB_ITEM
- TRANSFERRED_FROM 컬럼 추가 (이관 원본 보드 ID)
- TRANSFERRED_AT 컬럼 추가 (이관 일시)

---

## 4. API 설계

### 4.1 보드 관리 API

| Method | URL | 설명 |
|--------|-----|------|
| GET | /api/boards | 보드 목록 조회 |
| POST | /api/boards | 보드 생성 |
| GET | /api/boards/{id} | 보드 상세 조회 |
| PUT | /api/boards/{id} | 보드 수정 |
| DELETE | /api/boards/{id} | 보드 삭제 (논리) |
| PUT | /api/boards/{id}/order | 보드 순서 변경 |

### 4.2 업무 이관 API

| Method | URL | 설명 |
|--------|-----|------|
| GET | /api/boards/{id}/transfer/preview | 이관 대상 업무 미리보기 |
| POST | /api/boards/{id}/transfer | 업무 이관 실행 |

### 4.3 보드 공유 API

| Method | URL | 설명 |
|--------|-----|------|
| GET | /api/boards/{id}/shares | 공유 사용자 목록 |
| POST | /api/boards/{id}/shares | 공유 추가 |
| PUT | /api/boards/{id}/shares/{userId} | 권한 변경 |
| DELETE | /api/boards/{id}/shares/{userId} | 공유 제거 |

### 4.4 업무 공유 API

| Method | URL | 설명 |
|--------|-----|------|
| GET | /api/items/{id}/shares | 공유 사용자 목록 |
| POST | /api/items/{id}/shares | 공유 추가 |
| PUT | /api/items/{id}/shares/{userId} | 권한 변경 |
| DELETE | /api/items/{id}/shares/{userId} | 공유 제거 |

### 4.5 감사 로그 API

| Method | URL | 설명 |
|--------|-----|------|
| GET | /api/audit-logs | 감사 로그 조회 |
| GET | /api/audit-logs/boards/{id} | 보드별 이력 조회 |
| GET | /api/audit-logs/items/{id} | 업무별 이력 조회 |

---

## 5. 화면 설계

### 5.1 보드 관리 페이지 (BoardsView.vue)

```
┌─────────────────────────────────────────────────────────┐
│  보드 관리                              [+ 새 보드]     │
├─────────────────────────────────────────────────────────┤
│  ┌─ 내 보드 ──────────────────────────────────────────┐ │
│  │ 🟦 업무 관리        TABLE    3개 업무   [⋮]       │ │
│  │ 🟩 프로젝트 A       KANBAN   12개 업무  [⋮]       │ │
│  └─────────────────────────────────────────────────────┘ │
│  ┌─ 공유받은 보드 ────────────────────────────────────┐ │
│  │ 🟨 팀 프로젝트      EDIT     김철수     [⋮]       │ │
│  └─────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘

[⋮] 메뉴:
- 수정 (소유자/FULL)
- 공유 관리 (소유자)
- 삭제 (소유자)
```

### 5.2 보드 삭제/이관 모달

```
┌─────────────────────────────────────────────────────────┐
│  보드 삭제                                    [X]       │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ⚠️ 이 보드에는 미완료 업무가 3건 있습니다.              │
│                                                         │
│  업무를 다른 사용자에게 이관해주세요.                    │
│                                                         │
│  이관 대상자: [사용자 선택 ▼]                           │
│  이관 사유:   [선택 입력...]                            │
│                                                         │
│  ┌─ 이관 대상 업무 ─────────────────────────────────┐   │
│  │ □ 기획서 작성 (진행중)                           │   │
│  │ □ 디자인 검토 (대기)                             │   │
│  │ □ API 개발 (진행중)                              │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│              [취소]  [이관 후 삭제]                      │
└─────────────────────────────────────────────────────────┘
```

### 5.3 공유 관리 모달

```
┌─────────────────────────────────────────────────────────┐
│  공유 관리 - 업무 관리                       [X]        │
├─────────────────────────────────────────────────────────┤
│  사용자 추가: [사용자 검색...     ] [권한 ▼] [추가]     │
├─────────────────────────────────────────────────────────┤
│  ┌─ 공유 사용자 ───────────────────────────────────┐    │
│  │ 👤 김철수    [EDIT ▼]                    [X]    │    │
│  │ 👤 박영희    [VIEW ▼]                    [X]    │    │
│  │ 👤 이민수    [FULL ▼]                    [X]    │    │
│  └─────────────────────────────────────────────────┘    │
│                                                         │
│  권한 설명:                                             │
│  • VIEW: 조회만 가능                                    │
│  • EDIT: 조회 + 수정 가능                               │
│  • FULL: 조회 + 수정 + 삭제 가능                        │
│                                                         │
│                                    [닫기]               │
└─────────────────────────────────────────────────────────┘
```

### 5.4 메뉴 구조 변경

```
┌─────────────────────────────────────────┐
│  TaskFlow                               │
├─────────────────────────────────────────┤
│  📋 업무 페이지                          │
│  ⚠️ 지연 업무                            │
│  ⏸️ 보류 업무                            │
│  ✅ 완료 작업                            │
│  🗑️ 삭제된 작업                          │
│  ─────────────────────                  │
│  📝 작업 등록                            │
│  📊 이력 관리                            │
│  ─────────────────────                  │
│  👤 사용자 등록                          │
│  👥 공유 관리           ← 수정           │
│  ─────────────────────                  │
│  🏢 부서 관리                            │
│  📁 그룹 관리                            │
│  📋 보드 관리           ← 추가           │
│  ─────────────────────                  │
│  ⚙️ 설정                                 │
└─────────────────────────────────────────┘
```

---

## 6. 구현 순서

### Phase 1: 데이터베이스 (1단계)
1. TB_ITEM_SHARE 테이블 생성
2. TB_AUDIT_LOG 테이블 생성
3. TB_BOARD_SHARE PERMISSION 컬럼 수정
4. TB_ITEM 이관 컬럼 추가
5. 초기 데이터 스크립트 수정

### Phase 2: 백엔드 - 기본 CRUD (2단계)
1. Domain/DTO 클래스 생성
2. Mapper XML 작성
3. Service 구현
4. Controller 구현
5. 감사 로그 AOP 구현

### Phase 3: 백엔드 - 비즈니스 로직 (3단계)
1. 보드 삭제 + 업무 이관 로직
2. 권한 검증 로직
3. 공유 관리 로직

### Phase 4: 프론트엔드 (4단계)
1. BoardsView.vue 생성
2. 보드 생성/수정 모달
3. 보드 삭제/이관 모달
4. 공유 관리 모달 (보드/업무 통합)
5. 라우터 및 메뉴 추가

### Phase 5: 통합 및 테스트 (5단계)
1. API 연동 테스트
2. 권한 검증 테스트
3. 이력 기록 검증
4. UI/UX 검증

---

## 7. 체크리스트

### 7.1 DB 변경
- [ ] TB_ITEM_SHARE 생성
- [ ] TB_AUDIT_LOG 생성
- [ ] TB_BOARD_SHARE 수정
- [ ] TB_ITEM 수정
- [ ] 01_schema.sql 반영
- [ ] 02_init_data.sql 반영

### 7.2 백엔드
- [ ] ItemShare Domain/DTO
- [ ] AuditLog Domain/DTO
- [ ] ItemShareMapper.xml
- [ ] AuditLogMapper.xml
- [ ] BoardMapper.xml 수정
- [ ] ItemMapper.xml 수정
- [ ] BoardService 수정
- [ ] ItemShareService 생성
- [ ] AuditLogService 생성
- [ ] TransferService 생성
- [ ] BoardController 수정
- [ ] ItemShareController 생성
- [ ] AuditLogController 생성

### 7.3 프론트엔드
- [ ] BoardsView.vue
- [ ] BoardFormModal.vue
- [ ] BoardDeleteModal.vue
- [ ] ShareManageModal.vue
- [ ] board.ts (store)
- [ ] itemShare.ts (store)
- [ ] board.api.ts 수정
- [ ] itemShare.api.ts 생성
- [ ] 라우터 추가
- [ ] 사이드바 메뉴 추가

---

## 8. 승인

| 단계 | 산출물 | 상태 |
|------|--------|------|
| 1단계 | ERD 및 테이블 정의서 | 승인 대기 |
| 2단계 | API 명세서 | - |
| 3단계 | 컴포넌트 구조 | - |
| 4단계 | 구현 시작 | - |

---

*이 문서는 개발 진행에 따라 업데이트됩니다.*
